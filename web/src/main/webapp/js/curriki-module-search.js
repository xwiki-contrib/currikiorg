(function(){Ext.ns("Curriki.module.search");var A=Curriki.module.search;A.settings={gridWidth:(Ext.isIE6?620:"auto")};A.stateProvider=new Ext.state.CookieProvider({});Ext.state.Manager.setProvider(A.stateProvider);A.sessionProvider=new Ext.state.CookieProvider({expires:null})})();(function(){Ext.ns("Curriki.module.search.util");var A=Curriki.module.search;var B=A.util;B.init=function(){console.log("search util: init");B.logFilterList={resource:["subject","level","language","ict","review","special","other","sort","dir"],group:["subject","level","language","policy","other","sort","dir"],member:["subject","member_type","country","other","sort","dir"],blog:["other","sort","dir"],curriki:["other","sort","dir"]};B.registerTabTitleListener=function(C){Ext.StoreMgr.lookup("search-store-"+C).addListener("datachanged",function(I){var H=false;var K=0;var J=I.getTotalCount();if(!Ext.isEmpty(I.reader.jsonData)&&!Ext.isEmpty(I.reader.jsonData.totalResults)){K=parseInt(I.reader.jsonData.totalResults)}if(K>J){H=true}var E=Ext.getCmp("search-"+C+"-tab");if(!Ext.isEmpty(E)){var G=_("search.tab.title.results");if(H&&(_("search.tab.title.resultsmax_exceeds")!=="search.tab.title.resultsmax_exceeds")){G=_("search.tab.title.resultsmax_exceeds")}E.setTitle(String.format(G,_("search."+C+".tab.title"),J,K))}var F=Ext.getCmp("search-pager-"+C);if(!Ext.isEmpty(F)){var D=_("search.pagination.afterpage");if(H&&(_("search.pagination.afterpage_resultsmax_exceeds")!=="search.pagination.afterpage_resultsmax_exceeds")){D=_("search.pagination.afterpage_resultsmax_exceeds")}F.afterPageText=String.format(D,"{0}",K);var L=_("search.pagination.displaying."+C);if(H&&(_("search.pagination.displaying."+C+"_resultsmax_exceeds")!=="search.pagination.displaying."+C+"_resultsmax_exceeds")){L=_("search.pagination.displaying."+C+"_resultsmax_exceeds")}F.displayMsg=String.format(L,"{0}","{1}","{2}",K)}});Ext.StoreMgr.lookup("search-store-"+C).addListener("load",function(K,G,M){var F=M.params||{};var E=F.module;var H=escape(F.terms||"");var J=Ext.getCmp("search-advanced-"+E);var L=(J&&!J.collapsed)?"advanced":"simple";var I="";if(F.start){if(F.start!=="0"){I="/start/"+F.start}}var D="";Ext.each(B.logFilterList[E],function(N){if(!Ext.isEmpty(F[N],false)){D+="/"+N+"/"+escape(F[N])}});Curriki.logView("/features/search/"+E+"/"+H+"/"+L+D+I);A.doSearch(E,false,true)})};B.doSearch=function(G,H){console.log("Doing search",G,H);var E={};var D=Ext.getCmp("search-termPanel");if(!Ext.isEmpty(D)){var F=D.getForm();if(!Ext.isEmpty(F)){Ext.apply(E,F.getValues(false))}}Ext.apply(E,{module:G});D=Ext.getCmp("search-filterPanel-"+G);if(!Ext.isEmpty(D)){var F=D.getForm();if(!Ext.isEmpty(F)){Ext.apply(E,F.getValues(false))}}if(E.terms&&E.terms===_("search.text.entry.label")){E.terms=""}console.log("Applying search filters",E);Ext.apply(Ext.StoreMgr.lookup("search-store-"+G).baseParams||{},E);var C=Ext.getCmp("search-pager-"+G);if(!Ext.isEmpty(C)){console.log("Searching",E);C.doLoad(Ext.num(H,0))}console.log("Done util.doSearch",E)};B.createTermPanel=function(D,C){return{xtype:"panel",labelAlign:"left",id:"search-termPanel-"+D,cls:"term-panel",border:false,items:[{layout:"column",border:false,defaults:{border:false},items:[{layout:"form",id:"search-termPanel-"+D+"-form",cls:"search-termPanel-form",items:[{xtype:"textfield",id:"search-termPanel-"+D+"-terms",cls:"search-termPanel-terms",fieldLabel:_("search.text.entry.label"),name:"terms",hideLabel:true,emptyText:_("search.text.entry.label"),listeners:{specialkey:{fn:function(F,E){if(E.getKey()===Ext.EventObject.ENTER){E.stopEvent();A.doSearch(D,true)}}}}}]},{layout:"form",id:"search-termPanel-buttonColumn-"+D,cls:"search-termPanel-buttonColumn",items:[{xtype:"button",id:"search-termPanel-button-"+D,cls:"button button-confirm",text:_("search.text.entry.button"),listeners:{click:{fn:function(){A.doSearch(D,true)}}}}]},{xtype:"box",id:"search-termPanel-tips-"+D,cls:"search-termPanel-tips",autoEl:{html:'<a href="/xwiki/bin/view/Search/Tips?xpage=popup" target="search_tips" onclick="{var popup=window.open(this.href, \'search_tips\', \'width=725,height=400,status=no,toolbar=no,menubar=no,location=no,resizable=yes\'); popup.focus();} return false;">'+_("search.text.entry.help.button")+"</a>"}}]},{xtype:"hidden",name:"other",id:"search-termPanel-other-"+D,value:(!Ext.isEmpty(A.restrictions)?A.restrictions:"")}]}};B.fieldsetPanelSave=function(C,D){if(Ext.isEmpty(D)){D={}}if(!C.collapsed){D.collapsed=C.collapsed}else{D=null}console.log("fieldset Panel Save state:",D);A.sessionProvider.set(C.stateId||C.id,D)};B.fieldsetPanelRestore=function(C,D){if(!Ext.isEmpty(D)&&!Ext.isEmpty(D.collapsed)&&!D.collapsed){C.expand(false)}};B.registerSearchLogging=function(C){}};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){B.init()})})})();(function(){var B="resource";Ext.ns("Curriki.module.search.data."+B);var A=Curriki.module.search.data.resource;A.init=function(){console.log("data."+B+": init");A.filter={};var C=A.filter;C.data={};C.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("CurrikiCode.AssetClass_fw_items_FW_masterFramework.UNSPECIFIED")]]};C.data.subject.mapping.each(function(D){C.data.subject.list.push(D.id)});C.data.subject.list.push("UNCATEGORIZED");C.data.subject.list.each(function(D){C.data.subject.data.push([D,_("CurrikiCode.AssetClass_fw_items_"+D)])});C.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};C.data.subject.mapping.each(function(D){C.data.subsubject.data.push([D.id,_("CurrikiCode.AssetClass_fw_items_"+D.id+".UNSPECIFIED"),D.id]);C.data.subsubject.mapping[D.id].each(function(E){C.data.subsubject.data.push([E.id,_("CurrikiCode.AssetClass_fw_items_"+E.id),D.id])})});C.data.level={list:Curriki.data.el.list,data:[["",_("CurrikiCode.AssetClass_educational_level_UNSPECIFIED")]]};C.data.level.list.each(function(D){C.data.level.data.push([D,_("CurrikiCode.AssetClass_educational_level_"+D)])});C.data.ict={fullList:Curriki.data.ict.list,parentList:{},list:[],data:[["",_("CurrikiCode.AssetClass_instructional_component_UNSPECIFIED")]]};C.data.ict.fullList.each(function(E){var D=E.replace(/_.*/,"");C.data.ict.parentList[D]=D});Object.keys(C.data.ict.parentList).each(function(D){C.data.ict.data.push([D,_("CurrikiCode.AssetClass_instructional_component_"+D)])});C.data.subict={list:Curriki.data.ict.list,parents:{},data:[]};C.data.subict.list.each(function(E){var D=E.replace(/_.*/,"");if(D!==E){if(Ext.isEmpty(C.data.subict.parents[D])){C.data.subict.data.push([D+"*",_("CurrikiCode.AssetClass_instructional_component_"+D+"_UNSPECIFIED"),D]);C.data.subict.parents[D]=D}C.data.subict.data.push([E,_("CurrikiCode.AssetClass_instructional_component_"+E),D])}});C.data.language={list:Curriki.data.language.list,data:[["",_("CurrikiCode.AssetClass_language_UNSPECIFIED")]]};C.data.language.list.each(function(D){C.data.language.data.push([D,_("CurrikiCode.AssetClass_language_"+D)])});C.data.category={list:Curriki.data.category.list,data:[["",_("CurrikiCode.AssetClass_category_UNSPECIFIED"),"   "]]};C.data.category.list.each(function(E){var D=_("CurrikiCode.AssetClass_category_"+E);if(E==="unknown"){D="zzz"}if(E!=="collection"){C.data.category.data.push([E,_("CurrikiCode.AssetClass_category_"+E),D])}});C.data.review={list:["partners","highest_rated","members.highest_rated"],data:[["",_("search.resource.review.selector.UNSPECIFIED")]]};C.data.review.list.each(function(D){C.data.review.data.push([D,_("search.resource.review.selector."+D)])});C.data.special={list:["contributions","collections","updated"],data:[["",_("search.resource.special.selector.UNSPECIFIED")]]};C.data.special.list.each(function(D){C.data.special.data.push([D,_("search.resource.special.selector."+D)])});C.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:C.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:C.data.subsubject.data,id:0}),level:new Ext.data.SimpleStore({fields:["id","level"],data:C.data.level.data,id:0}),ict:new Ext.data.SimpleStore({fields:["id","ict"],data:C.data.ict.data,id:0}),subict:new Ext.data.SimpleStore({fields:["id","ict","parentICT"],data:C.data.subict.data,id:0}),language:new Ext.data.SimpleStore({fields:["id","language"],data:C.data.language.data,id:0}),category:new Ext.data.SimpleStore({fields:["id","category","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:C.data.category.data,id:0}),review:new Ext.data.SimpleStore({fields:["id","review"],data:C.data.review.data,id:0}),special:new Ext.data.SimpleStore({fields:["id","special"],data:C.data.special.data,id:0})};A.store={};A.store.record=new Ext.data.Record.create([{name:"title"},{name:"assetType"},{name:"category"},{name:"subcategory"},{name:"ict"},{name:"ictText"},{name:"ictIcon"},{name:"contributor"},{name:"contributorName"},{name:"rating",mapping:"review"},{name:"memberRating",mapping:"rating"},{name:"ratingCount"},{name:"description"},{name:"fwItems"},{name:"levels"},{name:"parents"},{name:"updated"}]);A.store.results=new Ext.data.Store({storeId:"search-store-"+B,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Resources",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},A.store.record),remoteSort:true});A.store.results.setDefaultSort("title","asc");A.renderer={title:function(N,M,G,L,P,O){var J=G.id.replace(/\./,"/");var H=Ext.util.Format.stripTags(G.data.description);H=Ext.util.Format.ellipsis(H,256);H=Ext.util.Format.htmlEncode(H);var F=Curriki.data.fw_item.getRolloverDisplay(G.data.fwItems||[]);var K=Curriki.data.el.getRolloverDisplay(G.data.levels||[]);H=String.format("{1}<br />{0}<br /><br />{3}<br />{2}<br />{5}<br />{4}",H,_("global.title.popup.description"),F,_("global.title.popup.subject"),K,_("global.title.popup.educationlevel"));var I=G.data.assetType;var D=G.data.category;var E=G.data.subcategory;M.css=String.format("resource-{0} category-{1} subcategory-{1}_{2}",I,D,E);var Q=_(D+"."+E);if(Q===D+"."+E){Q=_("unknown.unknown")}return String.format('<img class="x-tree-node-icon assettype-icon" src="{3}" ext:qtip="{4}" /><a href="/xwiki/bin/view/{0}" class="asset-title" ext:qtip="{2}">{1}</a>',J,Ext.util.Format.ellipsis(N,80),H,Ext.BLANK_IMAGE_URL,Q)},ict:function(K,J,G,I,M,L){var H;var E;var F=G.data.ict;if(!Ext.isEmpty(F)){var D=F.replace(/_.*/,"");H="ict-"+D;if(D!==F){H=H+" ict-"+F}E=F.replace(/_/,".")}else{H="ict-unknown";E="unknown"}J.css=H;return String.format('<img class="ict-icon" src="{1}" /><span class="ict-title">{0}</span>',_("search.resource.ict."+E),Ext.BLANK_IMAGE_URL)},contributor:function(I,G,D,J,F,E){var H=I.replace(/\./,"/");return String.format('<a href="/xwiki/bin/view/{0}">{1}</a>',H,D.data.contributorName)},rating:function(I,G,D,J,F,E){if(I!=""){var H=D.id.replace(/\./,"/");G.css=String.format("crs-{0}",I);return String.format('<a href="/xwiki/bin/view/{3}?viewer=comments"><img class="crs-icon" alt="" src="{2}" /><span class="crs-text">{1}</span></a>',I,_("search.resource.review."+I),Ext.BLANK_IMAGE_URL,H)}else{return String.format("")}},memberRating:function(J,H,E,K,G,F){if(J!=""){var I=E.id.replace(/\./,"/");var D=E.data.ratingCount;H.css=String.format("rating-{0}",J);return String.format('<a href="/xwiki/bin/view/{2}?viewer=comments"><img class="rating-icon" src="{4}" ext:qtip="{3}" /></a><a href="/xwiki/bin/view/{2}?viewer=comments" ext:qtip="{3}"> ({1})</a>',J,D,I,_("search.resource.rating."+J),Ext.BLANK_IMAGE_URL)}else{return String.format("")}},updated:function(I,G,D,J,F,E){var H=Ext.util.Format.date(I,"M-d-Y");return String.format("{0}",H)}}};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){A.init()})})})();(function(){var D="resource";Ext.ns("Curriki.module.search.form."+D);var A=Curriki.module.search;var B=A.form[D];var C=A.data[D];B.init=function(){console.log("form."+D+": init");var F=140;var E=250;B.ictCombo=function(G){Ext.apply(this,G)};Ext.extend(B.ictCombo,Ext.util.Observable,{init:function(G){Ext.apply(G,{tpl:'<tpl for="."><div class="x-combo-list-item ict-icon-combo-item ict-{'+G.valueField+'}"><img class="ict-icon" src="'+Ext.BLANK_IMAGE_URL+'"/><span class="ict-title">{'+G.displayField+"}</span></div></tpl>",onRender:G.onRender.createSequence(function(I,H){this.wrap.applyStyles({position:"relative"});this.el.addClass("ict-icon-combo-input");this.icon=Ext.DomHelper.append(this.el.up("div.x-form-field-wrap"),{tag:"div",style:"position:absolute",children:{tag:"div",cls:"ict-icon"}})}),setIconCls:function(){var H=this.store.query(this.valueField,this.getValue()).itemAt(0);if(H){this.icon.className="ict-icon-combo-icon ict-"+H.get(this.valueField)}},setValue:G.setValue.createSequence(function(H){this.setIconCls()})})}});B.categoryCombo=function(G){Ext.apply(this,G)};Ext.extend(B.categoryCombo,Ext.util.Observable,{init:function(G){Ext.apply(G,{tpl:'<tpl for="."><div class="x-combo-list-item category-icon-combo-item category-{'+G.valueField+'}"><img class="category-icon" src="'+Ext.BLANK_IMAGE_URL+'"/><span class="category-title">{'+G.displayField+"}</span></div></tpl>",onRender:G.onRender.createSequence(function(I,H){this.wrap.applyStyles({position:"relative"});this.el.addClass("category-icon-combo-input");this.icon=Ext.DomHelper.append(this.el.up("div.x-form-field-wrap"),{tag:"div",style:"position:absolute",children:{tag:"div",cls:"category-icon"}})}),setIconCls:function(){var H=this.store.query(this.valueField,this.getValue()).itemAt(0);if(H){this.icon.className="category-icon-combo-icon category-"+H.get(this.valueField)}},setValue:G.setValue.createSequence(function(H){this.setIconCls()})})}});B.termPanel=A.util.createTermPanel(D,B);B.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+D,formId:"search-filterForm-"+D,border:false,items:[B.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+D,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:A.util.fieldsetPanelSave},staterestore:{fn:A.util.fieldsetPanelRestore},expand:{fn:function(G){Ext.getCmp("search-results-"+D).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+D).setWidth(F);Ext.getCmp("search-termPanel-"+D).el.repaint()}},collapse:{fn:function(G){Ext.getCmp("search-results-"+D).getView().refresh();Ext.getCmp("search-termPanel-"+D).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-subject-"+D,fieldLabel:"Subject",hiddenName:"subjectparent",width:F,listWidth:E,mode:"local",store:C.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_fw_items_FW_masterFramework.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(I,H){var G=Ext.getCmp("combo-subsubject-"+D);if(I.getValue()===""){G.clearValue();G.hide()}else{if(I.getValue()==="UNCATEGORIZED"){G.show();G.clearValue();G.store.filter("parentItem",I.getValue());G.setValue(I.getValue());G.hide()}else{G.show();G.clearValue();G.store.filter("parentItem",I.getValue());G.setValue(I.getValue())}}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+D,hiddenName:"subject",width:F,listWidth:E,mode:"local",store:C.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"},{xtype:"combo",id:"combo-category-"+D,fieldLabel:"Category",hiddenName:"category",width:F,listWidth:E,mode:"local",store:C.filter.store.category,displayField:"category",valueField:"id",plugins:new B.categoryCombo(),typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_category_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-level-"+D,fieldLabel:"Level",mode:"local",width:F,listWidth:E,store:C.filter.store.level,hiddenName:"level",displayField:"level",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_educational_level_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-language-"+D,fieldLabel:"Language",hiddenName:"language",width:F,listWidth:E,mode:"local",store:C.filter.store.language,displayField:"language",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_language_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-review-"+D,fieldLabel:"Review",hiddenName:"review",width:F,listWidth:E,mode:"local",store:C.filter.store.review,displayField:"review",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.resource.review.selector.UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-ictprfx-"+D,fieldLabel:"Instructional Type",hiddenName:"ictprfx",width:F,listWidth:E,mode:"local",store:C.filter.store.ict,displayField:"ict",valueField:"id",plugins:new B.ictCombo(),typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_instructional_component_UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(J,G){var I=Ext.getCmp("combo-subICT-"+D);if(J.getValue()===""){I.clearValue();I.hide()}else{I.clearValue();I.store.filter("parentICT",J.getValue());var H=I.store.getById(J.getValue()+"*");if(Ext.isEmpty(H)){I.setValue(J.getValue());I.hide()}else{I.setValue(J.getValue()+"*");I.show()}}}}}},{xtype:"combo",fieldLabel:"Sub ICT",hiddenName:"ict",width:F,listWidth:E,id:"combo-subICT-"+D,mode:"local",store:C.filter.store.subict,displayField:"ict",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:"Select a Sub ICT...",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"},{xtype:"combo",id:"combo-special-"+D,fieldLabel:"Special Filters",hiddenName:"special",width:F,listWidth:E,mode:"local",store:C.filter.store.special,displayField:"special",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.resource.special.selector.UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};B.rowExpander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate(_("search.resource.resource.expanded.title"),"<ul>",'<tpl for="parents">','<li class="resource-{assetType} category-{category} subcategory-{category}_{subcategory}">','<a href="{[this.getParentURL(values)]}" ext:qtip="{[this.getQtip(values)]}">',"{title}","</a>","</li>","</tpl>","</ul>",{getParentURL:function(G){var H=G.page||false;if(H){return"/xwiki/bin/view/"+H.replace(/\./,"/")}else{return""}},getQtip:function(G){var J=Curriki.module.search.data.resource.filter;var K=Ext.util.Format.stripTags(G.description||"");K=Ext.util.Format.ellipsis(K,256);K=Ext.util.Format.htmlEncode(K);var I=Curriki.data.fw_item.getRolloverDisplay(G.fwItems||[]);var H=Curriki.data.el.getRolloverDisplay(G.levels||[]);return String.format("{1}<br />{0}<br /><br />{3}<br />{2}<br />{5}<br />{4}",K,_("global.title.popup.description"),I,_("global.title.popup.subject"),H,_("global.title.popup.educationlevel"))}})});B.rowExpander.renderer=function(I,J,H){var G;if(H.data.parents&&H.data.parents.size()>0){J.cellAttr='rowspan="2"';G="x-grid3-row-expander";return String.format('<img class="{0}" src="{1}" ext:qtip="{2}" />',G,Ext.BLANK_IMAGE_URL,_("search.resource.icon.plus.rollover"))}else{G="x-grid3-row-expander-empty";return String.format('<img class="{0}" src="{1}" />',G,Ext.BLANK_IMAGE_URL)}};B.rowExpander.on("expand",function(L,I,H,G){var K=L.grid.view.getRow(G);var J=Ext.DomQuery.selectNode("img[class=x-grid3-row-expander]",K);Ext.fly(J).set({"ext:qtip":_("search.resource.icon.minus.rollover")})});B.rowExpander.on("collapse",function(L,I,H,G){var K=L.grid.view.getRow(G);var J=Ext.DomQuery.selectNode("img[class=x-grid3-row-expander]",K);Ext.fly(J).set({"ext:qtip":_("search.resource.icon.plus.rollover")})});B.columnModel=new Ext.grid.ColumnModel([Ext.apply(B.rowExpander,{}),{id:"title",header:_("search.resource.column.header.title"),width:164,dataIndex:"title",sortable:true,hideable:false,renderer:C.renderer.title},{id:"ict",width:108,header:_("search.resource.column.header.ict"),dataIndex:"ictText",sortable:true,renderer:C.renderer.ict},{id:"contributor",width:110,header:_("search.resource.column.header.contributor"),dataIndex:"contributor",sortable:true,renderer:C.renderer.contributor},{id:"rating",width:88,header:_("search.resource.column.header.rating"),dataIndex:"rating",sortable:true,renderer:C.renderer.rating},{id:"memberRating",width:105,header:_("search.resource.column.header.member.rating"),dataIndex:"memberRating",sortable:true,renderer:C.renderer.memberRating},{id:"updated",width:80,header:_("search.resource.column.header.updated"),dataIndex:"updated",hidden:true,sortable:true,renderer:C.renderer.updated}]);B.resultsPanel={xtype:"grid",id:"search-results-"+D,border:false,autoHeight:true,width:A.settings.gridWidth,autoExpandColumn:"title",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:C.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:B.columnModel,loadMask:false,plugins:B.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+D,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:C.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+D),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};B.mainPanel={xtype:"panel",id:"search-panel-"+D,autoHeight:true,items:[B.filterPanel,B.resultsPanel]};B.doSearch=function(){A.util.doSearch(D)};A.util.registerTabTitleListener(D)};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){B.init()})})})();(function(){var B="group";Ext.ns("Curriki.module.search.data."+B);var A=Curriki.module.search.data.group;A.init=function(){console.log("data."+B+": init");A.filter={};var C=A.filter;C.data={};C.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("XWiki.CurrikiSpaceClass_topic_FW_masterFramework.WebHome.UNSPECIFIED")]]};C.data.subject.mapping.each(function(D){C.data.subject.list.push(D.id)});C.data.subject.list.each(function(D){C.data.subject.data.push([D,_("XWiki.CurrikiSpaceClass_topic_"+D)])});C.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};C.data.subject.mapping.each(function(D){C.data.subsubject.data.push([D.id,_("XWiki.CurrikiSpaceClass_topic_"+D.id+".UNSPECIFIED"),D.id]);C.data.subsubject.mapping[D.id].each(function(E){C.data.subsubject.data.push([E.id,_("XWiki.CurrikiSpaceClass_topic_"+E.id),D.id])})});C.data.level={list:Curriki.data.el.list,data:[["",_("XWiki.CurrikiSpaceClass_educationLevel_UNSPECIFIED")]]};C.data.level.list.each(function(D){C.data.level.data.push([D,_("XWiki.CurrikiSpaceClass_educationLevel_"+D)])});C.data.policy={list:["open","closed"],data:[["",_("search.XWiki.SpaceClass_policy_UNSPECIFIED")]]};C.data.policy.list.each(function(D){C.data.policy.data.push([D,_("search.XWiki.SpaceClass_policy_"+D)])});C.data.language={list:Curriki.data.language.list,data:[["",_("XWiki.CurrikiSpaceClass_language_UNSPECIFIED")]]};C.data.language.list.each(function(D){C.data.language.data.push([D,_("XWiki.CurrikiSpaceClass_language_"+D)])});C.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:C.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:C.data.subsubject.data,id:0}),level:new Ext.data.SimpleStore({fields:["id","level"],data:C.data.level.data,id:0}),policy:new Ext.data.SimpleStore({fields:["id","policy"],data:C.data.policy.data,id:0}),language:new Ext.data.SimpleStore({fields:["id","language"],data:C.data.language.data,id:0})};A.store={};A.store.record=new Ext.data.Record.create([{name:"title"},{name:"url"},{name:"policy"},{name:"description"},{name:"updated"}]);A.store.results=new Ext.data.Store({storeId:"search-store-"+B,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Groups",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},A.store.record),remoteSort:true});A.store.results.setDefaultSort("title","asc");A.renderer={title:function(H,G,D,I,F,E){return String.format('<a href="{0}">{1}</a>',D.data.url,H)},policy:function(H,G,D,J,F,E){if(H!==""){G.css="policy-"+H}var I=_("search.group.icon."+H);return String.format('<span ext:qtip="{1}">{0}</span>',I,_("search.group.icon."+H+".rollover"))},description:function(H,G,D,J,F,E){var I=Ext.util.Format.htmlDecode(H);I=Ext.util.Format.stripScripts(H);I=Ext.util.Format.stripTags(I);I=Ext.util.Format.ellipsis(I,128);I=Ext.util.Format.htmlEncode(I);I=Ext.util.Format.trim(I);return String.format("{0}",I)},updated:function(I,G,D,J,F,E){var H=Ext.util.Format.date(I,"M-d-Y");return String.format("{0}",H)}}};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){A.init()})})})();(function(){var D="group";Ext.ns("Curriki.module.search.form."+D);var A=Curriki.module.search;var B=A.form[D];var C=A.data[D];B.init=function(){console.log("form."+D+": init");var F=140;var E=250;B.termPanel=A.util.createTermPanel(D,B);B.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+D,formId:"search-filterForm-"+D,border:false,items:[B.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+D,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:A.util.fieldsetPanelSave},staterestore:{fn:A.util.fieldsetPanelRestore},expand:{fn:function(G){Ext.getCmp("search-results-"+D).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+D).setWidth(F);Ext.getCmp("search-termPanel-"+D).el.repaint()}},collapse:{fn:function(G){Ext.getCmp("search-results-"+D).getView().refresh();Ext.getCmp("search-termPanel-"+D).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",fieldLabel:"Subject",id:"combo-subject-"+D,hiddenName:"subjectparent",width:F,listWidth:E,mode:"local",store:C.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_topic_FW_masterFramework.WebHome.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(I,H){var G=Ext.getCmp("combo-subsubject-"+D);if(I.getValue()===""){G.clearValue();G.hide()}else{G.show();G.clearValue();G.store.filter("parentItem",I.getValue());G.setValue(I.getValue())}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+D,hiddenName:"subject",width:F,listWidth:E,mode:"local",store:C.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-level-"+D,fieldLabel:"Level",mode:"local",width:F,listWidth:E,store:C.filter.store.level,hiddenName:"level",displayField:"level",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_educationLevel_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-language-"+D,fieldLabel:"Language",hiddenName:"language",mode:"local",width:F,listWidth:E,store:C.filter.store.language,displayField:"language",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_language_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-policy-"+D,fieldLabel:"Membership Policy",hiddenName:"policy",mode:"local",width:F,listWidth:E,store:C.filter.store.policy,displayField:"policy",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.XWiki.SpaceClass_policy_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};B.columnModel=new Ext.grid.ColumnModel([{id:"policy",header:_("search.group.column.header.policy"),width:62,dataIndex:"policy",sortable:true,renderer:C.renderer.policy},{id:"title",header:_("search.group.column.header.name"),width:213,dataIndex:"title",sortable:true,hideable:false,renderer:C.renderer.title},{id:"description",width:225,header:_("search.group.column.header.description"),dataIndex:"description",sortable:false,renderer:C.renderer.description},{id:"updated",width:96,header:_("search.group.column.header.updated"),dataIndex:"updated",sortable:true,renderer:C.renderer.updated}]);B.resultsPanel={xtype:"grid",id:"search-results-"+D,border:false,autoHeight:true,width:A.settings.gridWidth,autoExpandColumn:"description",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:C.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:B.columnModel,loadMask:false,plugins:B.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+D,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:C.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+D),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};B.mainPanel={xtype:"panel",id:"search-panel-"+D,autoHeight:true,items:[B.filterPanel,B.resultsPanel]};B.doSearch=function(){A.util.doSearch(D)};A.util.registerTabTitleListener(D)};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){B.init()})})})();(function(){var B="member";Ext.ns("Curriki.module.search.data."+B);var A=Curriki.module.search.data.member;A.init=function(){console.log("data."+B+": init");A.filter={};var C=A.filter;C.data={};C.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("XWiki.XWikiUsers_topics_FW_masterFramework.WebHome.UNSPECIFIED")]]};C.data.subject.mapping.each(function(D){C.data.subject.list.push(D.id)});C.data.subject.list.each(function(D){C.data.subject.data.push([D,_("XWiki.XWikiUsers_topics_"+D)])});C.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};C.data.subject.mapping.each(function(D){C.data.subsubject.data.push([D.id,_("XWiki.XWikiUsers_topics_"+D.id+".UNSPECIFIED"),D.id]);C.data.subsubject.mapping[D.id].each(function(E){C.data.subsubject.data.push([E.id,_("XWiki.XWikiUsers_topics_"+E.id),D.id])})});C.data.country={list:"AD|AE|AF|AG|AI|AL|AM|AN|AO|AQ|AR|AS|AT|AU|AW|AX|AZ|BA|BB|BD|BE|BF|BG|BH|BI|BJ|BM|BN|BO|BR|BS|BT|BV|BW|BY|BZ|CA|CC|CD|CF|CG|CH|CI|CK|CL|CM|CN|CO|CR|CU|CV|CX|CY|CZ|DE|DJ|DK|DM|DO|DZ|EC|EE|EG|EH|ER|ES|ET|FI|FJ|FK|FM|FO|FR|GA|GB|GD|GE|GF|GG|GH|GI|GL|GM|GN|GP|GQ|GR|GS|GT|GU|GW|GY|HK|HM|HN|HR|HT|HU|ID|IE|IL|IM|IN|IO|IQ|IR|IS|IT|JE|JM|JO|JP|KE|KG|KH|KI|KM|KN|KP|KR|KW|KY|KZ|LA|LB|LC|LI|LK|LR|LS|LT|LU|LV|LY|MA|MC|MD|ME|MG|MH|MK|ML|MM|MN|MO|MP|MQ|MR|MS|MT|MU|MV|MW|MX|MY|MZ|NA|NC|NE|NF|NG|NI|NL|NO|NP|NR|NU|NZ|OM|PA|PE|PF|PG|PH|PK|PL|PM|PN|PR|PS|PT|PW|PY|QA|RE|RO|RS|RU|RW|SA|SB|SC|SD|SE|SG|SH|SI|SJ|SK|SL|SM|SN|SO|SR|ST|SV|SY|SZ|TC|TD|TF|TG|TH|TJ|TK|TL|TM|TN|TO|TR|TT|TV|TW|TZ|UA|UG|UM|US|UY|UZ|VA|VC|VE|VG|VI|VN|VU|WF|WS|YE|YT|ZA|ZM|ZW".split("|"),data:[["",_("XWiki.XWikiUsers_country_UNSPECIFIED")]]};C.data.country.list.each(function(D){C.data.country.data.push([D,_("XWiki.XWikiUsers_country_"+D)])});C.data.member_type={list:["parent","teacher","professional","student"],data:[["",_("XWiki.XWikiUsers_member_type_UNSPECIFIED")]]};C.data.member_type.list.each(function(D){C.data.member_type.data.push([D,_("XWiki.XWikiUsers_member_type_"+D)])});C.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:C.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:C.data.subsubject.data,id:0}),member_type:new Ext.data.SimpleStore({fields:["id","member_type"],data:C.data.member_type.data,id:0}),country:new Ext.data.SimpleStore({fields:["id","country"],data:C.data.country.data,id:0})};A.store={};A.store.record=new Ext.data.Record.create([{name:"name1"},{name:"name2"},{name:"url"},{name:"bio"},{name:"picture"},{name:"contributions"}]);A.store.results=new Ext.data.Store({storeId:"search-store-"+B,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Members",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},A.store.record),remoteSort:true});A.store.results.setDefaultSort("name1","asc");A.renderer={name1:function(H,G,D,I,F,E){return String.format('<a href="{1}">{0}</a>',H,D.data.url)},name2:function(H,G,D,I,F,E){return String.format('<a href="{1}">{0}</a>',H,D.data.url)},picture:function(H,G,D,I,F,E){return String.format('<a href="{2}"><img src="{0}" alt="{1}" class="member-picture" style="width:88px" /></a>',H,_("search.member.column.picture.alt.text"),D.data.url)},contributions:function(H,G,D,I,F,E){return String.format("{0}",H)},bio:function(H,G,D,J,F,E){var I=Ext.util.Format.htmlDecode(H);I=Ext.util.Format.stripScripts(H);I=Ext.util.Format.stripTags(I);I=Ext.util.Format.ellipsis(I,128);I=Ext.util.Format.htmlEncode(I);I=Ext.util.Format.trim(I);return String.format("{0}",I)}}};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){A.init()})})})();(function(){var D="member";Ext.ns("Curriki.module.search.form."+D);var A=Curriki.module.search;var B=A.form[D];var C=A.data[D];B.init=function(){console.log("form."+D+": init");var F=140;var E=250;B.termPanel=A.util.createTermPanel(D,B);B.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+D,formId:"search-filterForm-"+D,border:false,items:[B.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+D,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:A.util.fieldsetPanelSave},staterestore:{fn:A.util.fieldsetPanelRestore},expand:{fn:function(G){Ext.getCmp("search-results-"+D).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+D).setWidth(F);Ext.getCmp("search-termPanel-"+D).el.repaint()}},collapse:{fn:function(G){Ext.getCmp("search-results-"+D).getView().refresh();Ext.getCmp("search-termPanel-"+D).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-subject-"+D,fieldLabel:"Subject",hiddenName:"subjectparent",width:F,listWidth:E,mode:"local",store:C.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_topics_FW_masterFramework.WebHome.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(I,H){var G=Ext.getCmp("combo-subsubject-"+D);if(I.getValue()===""){G.clearValue();G.hide()}else{G.show();G.clearValue();G.store.filter("parentItem",I.getValue());G.setValue(I.getValue())}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+D,hiddenName:"subject",width:F,listWidth:E,mode:"local",store:C.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-member_type-"+D,fieldLabel:"Member Type",mode:"local",width:F,listWidth:E,store:C.filter.store.member_type,hiddenName:"member_type",displayField:"member_type",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_member_type_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-country-"+D,fieldLabel:"Country",hiddenName:"country",width:F,listWidth:E,mode:"local",store:C.filter.store.country,displayField:"country",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_country_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};B.columnModelList=[{id:"picture",header:_("search.member.column.header.picture"),width:116,dataIndex:"picture",sortable:false,resizable:false,menuDisabled:true,renderer:C.renderer.picture},{id:"name1",header:_("search.member.column.header.name1"),width:120,dataIndex:"name1",sortable:true,hideable:false,renderer:C.renderer.name1},{id:"name2",width:120,header:_("search.member.column.header.name2"),dataIndex:"name2",sortable:true,hideable:false,renderer:C.renderer.name2},{id:"bio",width:120,header:_("search.member.column.header.bio"),dataIndex:"bio",sortable:false,renderer:C.renderer.bio},{id:"contributions",width:120,header:_("search.member.column.header.contributions"),dataIndex:"contributions",sortable:false,renderer:C.renderer.contributions}];B.columnModel=new Ext.grid.ColumnModel(B.columnModelList);B.resultsPanel={xtype:"grid",id:"search-results-"+D,border:false,autoHeight:true,width:A.settings.gridWidth,autoExpandColumn:"bio",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:C.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:B.columnModel,loadMask:false,plugins:B.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+D,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:C.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+D),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};B.mainPanel={xtype:"panel",id:"search-panel-"+D,autoHeight:true,items:[B.filterPanel,B.resultsPanel]};B.doSearch=function(){A.util.doSearch(D)};A.util.registerTabTitleListener(D)};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){B.init()})})})();(function(){var B="blog";Ext.ns("Curriki.module.search.data."+B);var A=Curriki.module.search.data.blog;A.init=function(){console.log("data."+B+": init");A.store={};A.store.record=new Ext.data.Record.create([{name:"name"},{name:"title"},{name:"text"},{name:"comments"},{name:"updated"},{name:"memberUrl"},{name:"blogUrl"}]);A.store.results=new Ext.data.Store({storeId:"search-store-"+B,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Blogs",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},A.store.record),remoteSort:true});A.store.results.setDefaultSort("updated","desc");A.renderer={name:function(G,F,C,H,E,D){return String.format('<a href="{1}">{0}</a>',G,C.data.memberUrl)},text:function(G,F,C,I,E,D){var H=Ext.util.Format.htmlDecode(G);H=Ext.util.Format.stripScripts(G);H=Ext.util.Format.stripTags(H);H=Ext.util.Format.trim(H);H=Ext.util.Format.ellipsis(H,128);return String.format('<a href="{2}" class="search-blog-title">{1}</a><br /><br />{0}',H,C.data.title,C.data.blogUrl)},comments:function(G,F,C,H,E,D){return String.format("{0}",G)},updated:function(H,F,C,I,E,D){var G=Ext.util.Format.date(H,"M-d-Y");return String.format("{0}",G)}}};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){A.init()})})})();(function(){var D="blog";Ext.ns("Curriki.module.search.form."+D);var A=Curriki.module.search;var B=A.form[D];var C=A.data[D];B.init=function(){console.log("form."+D+": init");B.termPanel=A.util.createTermPanel(D,B);B.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+D,formId:"search-filterForm-"+D,border:false,items:[B.termPanel]};B.columnModel=new Ext.grid.ColumnModel([{id:"name",header:_("search.blog.column.header.name"),width:160,dataIndex:"name",sortable:true,renderer:C.renderer.name},{id:"text",header:_("search.blog.column.header.text"),width:260,dataIndex:"text",sortable:false,renderer:C.renderer.text},{id:"comments",header:_("search.blog.column.header.comments"),width:80,dataIndex:"comments",sortable:false,renderer:C.renderer.comments},{id:"updated",width:96,header:_("search.blog.column.header.updated"),dataIndex:"updated",sortable:true,renderer:C.renderer.updated}]);B.resultsPanel={xtype:"grid",id:"search-results-"+D,border:false,autoHeight:true,width:A.settings.gridWidth,autoExpandColumn:"text",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:C.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:B.columnModel,loadMask:false,bbar:new Ext.PagingToolbar({id:"search-pager-"+D,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:C.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+D),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};B.mainPanel={xtype:"panel",id:"search-panel-"+D,autoHeight:true,items:[B.filterPanel,B.resultsPanel]};B.doSearch=function(){A.util.doSearch(D)};A.util.registerTabTitleListener(D)};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){B.init()})})})();(function(){var B="curriki";Ext.ns("Curriki.module.search.data."+B);var A=Curriki.module.search.data.curriki;A.init=function(){console.log("data."+B+": init");A.store={};A.store.record=new Ext.data.Record.create([{name:"name"},{name:"updated"},{name:"url"}]);A.store.results=new Ext.data.Store({storeId:"search-store-"+B,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Curriki",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount"},A.store.record),remoteSort:true});A.store.results.setDefaultSort("name","asc");A.renderer={name:function(G,F,C,H,E,D){return String.format('<a href="{1}">{0}</a>',G,C.data.url)},updated:function(H,F,C,I,E,D){var G=Ext.util.Format.date(H,"M-d-Y");return String.format("{0}",G)}}};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){A.init()})})})();(function(){var D="curriki";Ext.ns("Curriki.module.search.form."+D);var A=Curriki.module.search;var B=A.form[D];var C=A.data[D];B.init=function(){console.log("form."+D+": init");B.termPanel=A.util.createTermPanel(D,B);B.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+D,formId:"search-filterForm-"+D,border:false,items:[B.termPanel]};B.columnModel=new Ext.grid.ColumnModel([{id:"name",header:_("search.curriki.column.header.name"),width:500,dataIndex:"name",sortable:true,renderer:C.renderer.name},{id:"updated",width:96,header:_("search.curriki.column.header.updated"),dataIndex:"updated",sortable:true,renderer:C.renderer.updated}]);B.resultsPanel={xtype:"grid",id:"search-results-"+D,border:false,autoHeight:true,width:A.settings.gridWidth,autoExpandColumn:"name",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:C.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:B.columnModel,loadMask:false,bbar:new Ext.PagingToolbar({id:"search-pager-"+D,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:C.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+D),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};B.mainPanel={xtype:"panel",id:"search-panel-"+D,autoHeight:true,items:[B.filterPanel,B.resultsPanel]};B.doSearch=function(){A.util.doSearch(D)};A.util.registerTabTitleListener(D)};Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){B.init()})})})();(function(){Ext.ns("Curriki.module.search.form");var B=Curriki.module.search;var A=B.form;B.init=function(){console.log("search: init");if(Ext.isEmpty(B.initialized)){if(Ext.isEmpty(B.tabList)){B.tabList=["resource","group","member","blog","curriki"]}var D=140;B.doSearch=function(J,H,I){var F={};if(Ext.getCmp("search-termPanel")&&Ext.getCmp("search-termPanel").getForm){F.all=Ext.getCmp("search-termPanel").getForm().getValues(false)}var K={};var E={};Ext.each(B.tabList,function(R){var Q=A[R];if(!Ext.isEmpty(Q)&&!Ext.isEmpty(Q.doSearch)){var P=Ext.getCmp("search-filterPanel-"+R);if(!Ext.isEmpty(P)){var S=P.getForm();if(!Ext.isEmpty(S)){F[R]=S.getValues(false);if("undefined"!==typeof F[R]["terms"]&&F[R]["terms"]===_("search.text.entry.label")){delete (F[R]["terms"])}if("undefined"!==typeof F[R]["other"]&&F[R]["other"]===""){delete (F[R]["other"])}}}var N=Ext.getCmp("search-advanced-"+R);if(!Ext.isEmpty(N)){if(!N.collapsed){E[R]={a:true}}}var O=Ext.getCmp("search-pager-"+R);if(!Ext.isEmpty(O)){var T={};T.c=(("undefined"===typeof H)||(H!==true))?O.cursor:0;T.s=O.pageSize;K[R]=T}if((("undefined"===typeof I)||(I=false))&&(Ext.isEmpty(J)||J===R)){console.log("now util.doSearch",R,K);B.util.doSearch(R,(("undefined"!==typeof K[R])?K[R].c:0))}}});var G={};G.s=Ext.isEmpty(J)?"all":J;G.f=F;G.p=K;if(Ext.getCmp("search-tabPanel").getActiveTab){G.t=Ext.getCmp("search-tabPanel").getActiveTab().id}G.a=E;var L=new Ext.state.Provider();var M=L.encodeValue(G);console.log("Saving History",{values:G});B.history.setLastToken(M);Ext.History.add(M)};B.tabPanel={xtype:(B.tabList.size()>1?"tab":"")+"panel",id:"search-tabPanel",activeTab:0,deferredRender:false,autoHeight:true,layoutOnTabChange:true,frame:false,border:false,plain:true,defaults:{autoScroll:false,border:false},listeners:{tabchange:function(H,G){var F=G.id.replace(/(^search-|-tab$)/g,"");Curriki.logView("/features/search/"+F);var E=Ext.getCmp("search-advanced-"+F);if(!Ext.isEmpty(E)){if(!E.collapsed){Ext.select(".x-form-field-wrap",false,"search-advanced-"+F).setWidth(D)}}}},items:[]};Ext.each(B.tabList,function(E){panel={title:_("search."+E+".tab.title"),id:"search-"+E+"-tab",cls:"search-"+E,autoHeight:true};module=A[E];if(!Ext.isEmpty(module)&&!Ext.isEmpty(module.mainPanel)){panel.items=[module.mainPanel];B.tabPanel.items.push(panel)}});B.mainPanel={el:"search-div",border:false,height:"600px",defaults:{border:false},cls:"search-module",items:[B.tabPanel]};Ext.ns("Curriki.module.search.history");var C=B.history;C.lastHistoryToken=false;C.historyChange=function(E){if(E){if(E==C.lastHistoryToken){}else{C.updateFromHistory(E)}}else{}};C.setLastToken=function(E){C.lastHistoryToken=E};C.updateFromHistory=function(F){var J=new Ext.state.Provider();var E=J.decodeValue(F);console.log("Got History",{token:F,values:E});if(!Ext.isEmpty(E)){var I=E.f;if(!Ext.isEmpty(I)&&I.all&&Ext.getCmp("search-termPanel")&&Ext.getCmp("search-termPanel").getForm){Ext.getCmp("search-termPanel").getForm().setValues(I.all)}var G=E.p;var H=E.a;if(E.t){if(Ext.getCmp("search-tabPanel").setActiveTab){Ext.getCmp("search-tabPanel").setActiveTab(E.t)}}Ext.each(B.tabList,function(O){console.log("Updating "+O);var N=B.form[O];if(!Ext.isEmpty(N)&&!Ext.isEmpty(N.doSearch)&&!Ext.isEmpty(I)&&!Ext.isEmpty(I[O])){var M=Ext.getCmp("search-filterPanel-"+O);if(!Ext.isEmpty(M)){var Q=M.getForm();if(!Ext.isEmpty(Q)){try{Q.setValues(I[O]);var P=Ext.getCmp("combo-subject-"+O);if(P){P.fireEvent("select",P,P.getValue());if(!Ext.isEmpty(I[O].subject)){if(Ext.getCmp("combo-subsubject-"+O)){Ext.getCmp("combo-subsubject-"+O).setValue(I[O].subject)}}}P=Ext.getCmp("combo-ictprfx-"+O);if(P){P.fireEvent("select",P,P.getValue());if(!Ext.isEmpty(I[O].ict)){if(Ext.getCmp("combo-subICT-"+O)){Ext.getCmp("combo-subICT-"+O).setValue(I[O].ict)}}}}catch(R){console.log("ERROR Updating "+O,R)}}}if(!Ext.isEmpty(H)&&!Ext.isEmpty(H[O])&&H[O].a){var L=Ext.getCmp("search-advanced-"+O);if(!Ext.isEmpty(L)){L.expand(false)}}var K=Ext.getCmp("search-pager-"+O);if(!Ext.isEmpty(K)&&!Ext.isEmpty(G)){if(G[O]){try{if(G[O]["c"]){K.cursor=G[O]["c"]}if(G[O]["s"]){if(K.pageSize!=G[O]["s"]){K.setPageSize(G[O]["s"])}}}catch(R){console.log("ERROR Updating "+O,R)}}}}});if(E.s){console.log("Starting search");if(E.s==="all"){B.doSearch()}else{B.doSearch(E.s)}}C.setLastToken(F)}};C.init=function(){if(Ext.isEmpty(C.initialized)){var E=Ext.History.getToken();Ext.History.init(function(){Ext.History.on("change",C.historyChange);if(E){C.historyChange(E)}});C.initialized=true}};B.initialized=true;console.log("search: init done")}};B.display=function(){B.init();var C=new Ext.Panel(B.mainPanel);C.render();B.history.init()};B.start=function(){Ext.onReady(function(){Curriki.data.EventManager.on("Curriki.data:ready",function(){B.display()})})}})();