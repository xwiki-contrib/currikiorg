(function(){Ext.ns("Curriki.module.search");var a=Curriki.module.search;a.settings={gridWidth:(Ext.isIE6?620:"auto")};a.stateProvider=new Ext.state.CookieProvider({});Ext.state.Manager.setProvider(a.stateProvider);a.sessionProvider=new Ext.state.CookieProvider({expires:null})})();(function(){Ext.ns("Curriki.module.search.util");var a=Curriki.module.search;var b=a.util;b.init=function(){console.log("search util: init");b.logFilterList={resource:["subject","level","language","ict","review","special","other","sort","dir"],group:["subject","level","language","policy","other","sort","dir"],member:["subject","member_type","country","other","sort","dir"],blog:["other","sort","dir"],curriki:["other","sort","dir"]};b.registerTabTitleListener=function(c){Ext.StoreMgr.lookup("search-store-"+c).addListener("datachanged",function(i){var h=false;var k=0;var j=i.getTotalCount();if(!Ext.isEmpty(i.reader.jsonData)&&!Ext.isEmpty(i.reader.jsonData.totalResults)){k=parseInt(i.reader.jsonData.totalResults)}if(k>j){h=true}var e=Ext.getCmp("search-"+c+"-tab");if(!Ext.isEmpty(e)){var g=_("search.tab.title.results");if(h&&(_("search.tab.title.resultsmax_exceeds")!=="search.tab.title.resultsmax_exceeds")){g=_("search.tab.title.resultsmax_exceeds")}e.setTitle(String.format(g,_("search."+c+".tab.title"),j,k))}var f=Ext.getCmp("search-pager-"+c);if(!Ext.isEmpty(f)){var d=_("search.pagination.afterpage");if(h&&(_("search.pagination.afterpage_resultsmax_exceeds")!=="search.pagination.afterpage_resultsmax_exceeds")){d=_("search.pagination.afterpage_resultsmax_exceeds")}f.afterPageText=String.format(d,"{0}",k);var l=_("search.pagination.displaying."+c);if(h&&(_("search.pagination.displaying."+c+"_resultsmax_exceeds")!=="search.pagination.displaying."+c+"_resultsmax_exceeds")){l=_("search.pagination.displaying."+c+"_resultsmax_exceeds")}f.displayMsg=String.format(l,"{0}","{1}","{2}",k)}});Ext.StoreMgr.lookup("search-store-"+c).addListener("beforeload",function(f,g){var e=Ext.StoreMgr.lookup("search-store-"+c);var d=Ext.getCmp("search-pager-"+c);e.baseParams.rows=d.pageSize;return true});Ext.StoreMgr.lookup("search-store-"+c).addListener("load",function(k,g,m){var f=m.params||{};var e=f.module;var h=escape(f.terms||"");var j=Ext.getCmp("search-advanced-"+e);var l=(j&&!j.collapsed)?"advanced":"simple";var i="";if(f.start){if(f.start!=="0"){i="/start/"+f.start}}var d="";Ext.each(b.logFilterList[e],function(n){if(!Ext.isEmpty(f[n],false)){d+="/"+n+"/"+escape(f[n])}});Curriki.logView("/features/search/"+e+"/"+h+"/"+l+d+i)});Ext.StoreMgr.lookup("search-store-"+c).addListener("exception",Curriki.notifyException)};b.doSearch=function(g,h){console.log("Doing search",g,h);var e={};var d=Ext.getCmp("search-termPanel");if(!Ext.isEmpty(d)){var f=d.getForm();if(!Ext.isEmpty(f)){Ext.apply(e,f.getValues(false))}}Ext.apply(e,{module:g});d=Ext.getCmp("search-filterPanel-"+g);if(!Ext.isEmpty(d)){var f=d.getForm();if(!Ext.isEmpty(f)){Ext.apply(e,f.getValues(false))}}if(e.terms&&e.terms===_("search.text.entry.label")){e.terms=""}console.log("Applying search filters",e);Ext.apply(Ext.StoreMgr.lookup("search-store-"+g).baseParams||{},e);var c=Ext.getCmp("search-pager-"+g);if(!Ext.isEmpty(c)){console.log("Searching",e);c.doLoad(Ext.num(h,0))}console.log("Done util.doSearch",e)};b.createTermPanel=function(d,c){return{xtype:"panel",labelAlign:"left",id:"search-termPanel-"+d,cls:"term-panel",border:false,items:[{layout:"column",border:false,defaults:{border:false},items:[{layout:"form",id:"search-termPanel-"+d+"-form",cls:"search-termPanel-form",items:[{xtype:"textfield",id:"search-termPanel-"+d+"-terms",cls:"search-termPanel-terms",fieldLabel:_("search.text.entry.label"),name:"terms",hideLabel:true,emptyText:_("search.text.entry.label"),listeners:{specialkey:{fn:function(g,f){if(f.getKey()===Ext.EventObject.ENTER){f.stopEvent();if("resource"==d&&Ext.StoreMgr.lookup("search-store-resource").sortInfo){Ext.StoreMgr.lookup("search-store-resource").sortInfo.field="score";Ext.StoreMgr.lookup("search-store-resource").sortInfo.direction="DESC"}a.doSearch(d,true)}}}}}]},{layout:"form",id:"search-termPanel-buttonColumn-"+d,cls:"search-termPanel-buttonColumn",items:[{xtype:"button",id:"search-termPanel-button-"+d,cls:"search-termPanel-button",text:_("search.text.entry.button"),listeners:{click:{fn:function(){if("resource"==d&&Ext.StoreMgr.lookup("search-store-resource").sortInfo){Ext.StoreMgr.lookup("search-store-resource").sortInfo.field="score";Ext.StoreMgr.lookup("search-store-resource").sortInfo.direction="DESC"}a.doSearch(d,true)}}}}]},{xtype:"box",id:"search-termPanel-tips-"+d,cls:"search-termPanel-tips",autoEl:{html:'<a href="/xwiki/bin/view/Search/Tips?xpage=popup" target="search_tips" onclick="{var popup=window.open(this.href, \'search_tips\', \'width=725,height=400,status=no,toolbar=no,menubar=no,location=no,resizable=yes\'); popup.focus();} return false;">'+_("search.text.entry.help.button")+"</a>"}}]},{xtype:"hidden",name:"other",id:"search-termPanel-other-"+d,value:(!Ext.isEmpty(a.restrictions)?a.restrictions:"")}]}};b.fieldsetPanelSave=function(c,d){if(Ext.isEmpty(d)){d={}}if(!c.collapsed){d.collapsed=c.collapsed}else{d=null}console.log("fieldset Panel Save state:",d);a.sessionProvider.set(c.stateId||c.id,d)};b.fieldsetPanelRestore=function(c,d){if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.collapsed)&&!d.collapsed){c.expand(false)}};b.registerSearchLogging=function(c){}};Ext.onReady(function(){b.init()})})();(function(){var b="resource";Ext.ns("Curriki.module.search.data."+b);var a=Curriki.module.search.data.resource;a.init=function(){console.log("data."+b+": init");a.filter={};var c=a.filter;c.data={};c.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("CurrikiCode.AssetClass_fw_items_FW_masterFramework.UNSPECIFIED")]]};c.data.subject.mapping.each(function(d){c.data.subject.list.push(d.id)});c.data.subject.list.push("UNCATEGORIZED");c.data.subject.list.each(function(d){c.data.subject.data.push([d,_("CurrikiCode.AssetClass_fw_items_"+d)])});c.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};c.data.subject.mapping.each(function(d){c.data.subsubject.data.push([d.id,_("CurrikiCode.AssetClass_fw_items_"+d.id+".UNSPECIFIED"),d.id]);c.data.subsubject.mapping[d.id].each(function(e){c.data.subsubject.data.push([e.id,_("CurrikiCode.AssetClass_fw_items_"+e.id),d.id])})});c.data.level={list:Curriki.data.el.list,data:[["",_("CurrikiCode.AssetClass_educational_level_UNSPECIFIED")]]};c.data.level.list.each(function(d){c.data.level.data.push([d,_("CurrikiCode.AssetClass_educational_level_"+d)])});c.data.ict={fullList:Curriki.data.ict.list,parentList:{},list:[],data:[["",_("CurrikiCode.AssetClass_instructional_component_UNSPECIFIED","   ")]]};c.data.ict.fullList.each(function(e){var d=e.replace(/_.*/,"");c.data.ict.parentList[d]=d});Object.keys(c.data.ict.parentList).each(function(e){var d=_("CurrikiCode.AssetClass_instructional_component_"+e);if(e==="other"){d="zzz"}c.data.ict.data.push([e,_("CurrikiCode.AssetClass_instructional_component_"+e),d])});c.data.subict={list:Curriki.data.ict.list,parents:{},data:[]};c.data.subict.list.each(function(f){var d=f.replace(/_.*/,"");if(d!==f){if(Ext.isEmpty(c.data.subict.parents[d])){c.data.subict.data.push([d+"*",_("CurrikiCode.AssetClass_instructional_component_"+d+"_UNSPECIFIED"),d,"   "]);c.data.subict.parents[d]=d}var e=_("CurrikiCode.AssetClass_instructional_component_"+f);if(f==="other"){e="zzz"}c.data.subict.data.push([f,_("CurrikiCode.AssetClass_instructional_component_"+f),d,e])}});c.data.language={list:Curriki.data.language.list,data:[["",_("CurrikiCode.AssetClass_language_UNSPECIFIED")]]};c.data.language.list.each(function(d){c.data.language.data.push([d,_("CurrikiCode.AssetClass_language_"+d)])});c.data.category={list:Curriki.data.category.list,data:[["",_("CurrikiCode.AssetClass_category_UNSPECIFIED"),"   "]]};c.data.category.list.each(function(e){var d=_("CurrikiCode.AssetClass_category_"+e);if(e==="unknown"){d="zzz"}if(e!=="collection"){c.data.category.data.push([e,_("CurrikiCode.AssetClass_category_"+e),d])}});c.data.review={list:["partners","highest_rated","members.highest_rated"],data:[["",_("search.resource.review.selector.UNSPECIFIED")]]};c.data.review.list.each(function(d){c.data.review.data.push([d,_("search.resource.review.selector."+d)])});c.data.special={list:["contributions","collections","updated","info-only"],data:[["",_("search.resource.special.selector.UNSPECIFIED")]]};c.data.special.list.each(function(d){c.data.special.data.push([d,_("search.resource.special.selector."+d)])});c.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:c.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:c.data.subsubject.data,id:0}),level:new Ext.data.SimpleStore({fields:["id","level"],data:c.data.level.data,id:0}),ict:new Ext.data.SimpleStore({fields:["id","ict","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:c.data.ict.data,id:0}),subict:new Ext.data.SimpleStore({fields:["id","ict","parentICT","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:c.data.subict.data,id:0}),language:new Ext.data.SimpleStore({fields:["id","language"],data:c.data.language.data,id:0}),category:new Ext.data.SimpleStore({fields:["id","category","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:c.data.category.data,id:0}),review:new Ext.data.SimpleStore({fields:["id","review"],data:c.data.review.data,id:0}),special:new Ext.data.SimpleStore({fields:["id","special"],data:c.data.special.data,id:0})};a.store={};a.store.record=new Ext.data.Record.create([{name:"title"},{name:"assetType"},{name:"category"},{name:"subcategory"},{name:"ict"},{name:"ictText"},{name:"ictIcon"},{name:"contributor"},{name:"contributorName"},{name:"rating",mapping:"review"},{name:"memberRating",mapping:"rating"},{name:"ratingCount"},{name:"description"},{name:"fwItems"},{name:"levels"},{name:"parents"},{name:"lastUpdated"},{name:"updated"},{name:"score"}]);a.store.results=new Ext.data.Store({storeId:"search-store-"+b,proxy:new Ext.data.HttpProxy({url:document.location.pathname.endsWith("Old")?"/xwiki/bin/view/Search/Resources":"/currikiExtjs",method:"GET"}),baseParams:{xpage:"plain"},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},a.store.record),remoteSort:true});if(Curriki.userinfo.userGroups){a.store.results.baseParams.groupsId=Curriki.userinfo.userGroups}if(Curriki.userinfo.userName){a.store.results.baseParams.userId=Curriki.userinfo.userName}if(Curriki.userinfo.isAdmin){a.store.results.baseParams.isAdmin=true}a.store.results.setDefaultSort("score","desc");a.renderer={title:function(p,o,g,n,r,q){var l=g.id.replace(/\./,"/");var h=Ext.util.Format.stripTags(g.data.description);h=Ext.util.Format.ellipsis(h,256);h=Ext.util.Format.htmlEncode(h);var f=Curriki.data.fw_item.getRolloverDisplay(g.data.fwItems||[]);var m=Curriki.data.el.getRolloverDisplay(g.data.levels||[]);var k=g.data.lastUpdated||"";var j="{1}<br />{0}<br /><br />";if(k!==""){j=j+"{7}<br />{6}<br /><br />"}j=j+"{3}<br />{2}<br />{5}<br />{4}";h=String.format(j,h,_("global.title.popup.description"),f,_("global.title.popup.subject"),m,_("global.title.popup.educationlevel"),k,_("global.title.popup.last_updated"));var i=g.data.assetType;var d=g.data.category;var e=g.data.subcategory;o.css=String.format("resource-{0} category-{1} subcategory-{1}_{2}",i,d,e);var s=_(d+"."+e);if(s===d+"."+e){s=_("unknown.unknown")}return String.format('<img class="x-tree-node-icon assettype-icon" src="{3}" ext:qtip="{4}" /><a href="/xwiki/bin/view/{0}" class="asset-title" ext:qtip="{2}">{1}</a>',l,Ext.util.Format.ellipsis(p,80),h,Ext.BLANK_IMAGE_URL,s)},ict:function(k,j,g,i,m,l){var h;var e;var f=g.data.ict;if(!Ext.isEmpty(f)){var d=f.replace(/_.*/,"");h="ict-"+d;if(d!==f){h=h+" ict-"+f}e=f.replace(/_/,".")}else{h="ict-unknown";e="unknown"}j.css=h;return String.format('<img class="ict-icon" src="{1}" /><span class="ict-title">{0}</span>',_("search.resource.ict."+e),Ext.BLANK_IMAGE_URL)},contributor:function(i,g,d,j,f,e){var h=i.replace(/\./,"/");return String.format('<a href="/xwiki/bin/view/{0}">{1}</a>',h,d.data.contributorName)},rating:function(i,g,d,j,f,e){if(i!=""){var h=d.id.replace(/\./,"/");g.css=String.format("crs-{0}",i);return String.format('<a href="/xwiki/bin/view/{3}?viewer=comments"><img class="crs-icon" alt="" src="{2}" /><span class="crs-text">{1}</span></a>',i,_("search.resource.review."+i),Ext.BLANK_IMAGE_URL,h)}else{return String.format("")}},memberRating:function(j,h,e,k,g,f){if(j!=""&&j!="0"&&j!=0){var i=e.id.replace(/\./,"/");var d=e.data.ratingCount;if(d!=""&&d!="0"&&d!=0){h.css=String.format("rating-{0}",j);return String.format('<a href="/xwiki/bin/view/{2}?viewer=comments"><img class="rating-icon" src="{4}" ext:qtip="{3}" /></a><a href="/xwiki/bin/view/{2}?viewer=comments" ext:qtip="{3}"> ({1})</a>',j,d,i,_("search.resource.rating."+j),Ext.BLANK_IMAGE_URL)}else{return String.format("")}}else{return String.format("")}},updated:function(i,g,d,j,f,e){var h=Ext.util.Format.date(i,"M-d-Y");return String.format("{0}",h)},score:function(h,g,d,i,f,e){return h}}};Ext.onReady(function(){a.init()})})();(function(){var d="resource";Ext.ns("Curriki.module.search.form."+d);var a=Curriki.module.search;var b=a.form[d];var c=a.data[d];b.init=function(){console.log("form."+d+": init");var h=140;var e=250;b.ictCombo=function(i){Ext.apply(this,i)};var g=$("curriki-searchbox");if(!Ext.isEmpty(g)){g.setValue("...");g.setAttribute("curriki:deftxt","...");g.disable()}var f=$("searchbtn");if(!Ext.isEmpty(f)){f.innerHTML=""}Ext.extend(b.ictCombo,Ext.util.Observable,{init:function(i){Ext.apply(i,{tpl:'<tpl for="."><div class="x-combo-list-item ict-icon-combo-item ict-{'+i.valueField+'}"><img class="ict-icon" src="'+Ext.BLANK_IMAGE_URL+'"/><span class="ict-title">{'+i.displayField+"}</span></div></tpl>",onRender:i.onRender.createSequence(function(k,j){this.wrap.applyStyles({position:"relative"});this.el.addClass("ict-icon-combo-input");this.icon=Ext.DomHelper.append(this.el.up("div.x-form-field-wrap"),{tag:"div",style:"position:absolute",children:{tag:"div",cls:"ict-icon"}})}),setIconCls:function(){var j=this.store.query(this.valueField,this.getValue()).itemAt(0);if(j){this.icon.className="ict-icon-combo-icon ict-"+j.get(this.valueField)}},setValue:i.setValue.createSequence(function(j){this.setIconCls()})})}});b.categoryCombo=function(i){Ext.apply(this,i)};Ext.extend(b.categoryCombo,Ext.util.Observable,{init:function(i){Ext.apply(i,{tpl:'<tpl for="."><div class="x-combo-list-item category-icon-combo-item category-{'+i.valueField+'}"><img class="category-icon" src="'+Ext.BLANK_IMAGE_URL+'"/><span class="category-title">{'+i.displayField+"}</span></div></tpl>",onRender:i.onRender.createSequence(function(k,j){this.wrap.applyStyles({position:"relative"});this.el.addClass("category-icon-combo-input");this.icon=Ext.DomHelper.append(this.el.up("div.x-form-field-wrap"),{tag:"div",style:"position:absolute",children:{tag:"div",cls:"category-icon"}})}),setIconCls:function(){var j=this.store.query(this.valueField,this.getValue()).itemAt(0);if(j){this.icon.className="category-icon-combo-icon category-"+j.get(this.valueField)}},setValue:i.setValue.createSequence(function(j){this.setIconCls()})})}});b.termPanel=a.util.createTermPanel(d,b);b.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+d,formId:"search-filterForm-"+d,border:false,items:[b.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+d,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:a.util.fieldsetPanelSave},staterestore:{fn:a.util.fieldsetPanelRestore},expand:{fn:function(i){Ext.getCmp("search-results-"+d).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+d).setWidth(h);Ext.getCmp("search-termPanel-"+d).el.repaint()}},collapse:{fn:function(i){Ext.getCmp("search-results-"+d).getView().refresh();Ext.getCmp("search-termPanel-"+d).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-subject-"+d,fieldLabel:"Subject",hiddenName:"subjectparent",width:h,listWidth:e,mode:"local",store:c.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_fw_items_FW_masterFramework.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(k,j){var i=Ext.getCmp("combo-subsubject-"+d);if(k.getValue()===""){i.clearValue();i.hide()}else{if(k.getValue()==="UNCATEGORIZED"){i.show();i.clearValue();i.store.filter("parentItem",k.getValue());i.setValue(k.getValue());i.hide()}else{i.show();i.clearValue();i.store.filter("parentItem",k.getValue());i.setValue(k.getValue())}}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+d,hiddenName:"subject",width:h,listWidth:e,mode:"local",store:c.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"},{xtype:"combo",id:"combo-category-"+d,fieldLabel:"Category",hiddenName:"category",width:h,listWidth:e,mode:"local",store:c.filter.store.category,displayField:"category",valueField:"id",plugins:new b.categoryCombo(),typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_category_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-level-"+d,fieldLabel:"Level",mode:"local",width:h,listWidth:e,store:c.filter.store.level,hiddenName:"level",displayField:"level",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_educational_level_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-language-"+d,fieldLabel:"Language",hiddenName:"language",width:h,listWidth:e,mode:"local",store:c.filter.store.language,displayField:"language",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_language_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-review-"+d,fieldLabel:"Review",hiddenName:"review",width:h,listWidth:e,mode:"local",store:c.filter.store.review,displayField:"review",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.resource.review.selector.UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-ictprfx-"+d,fieldLabel:"Instructional Type",hiddenName:"ictprfx",width:h,listWidth:e,mode:"local",store:c.filter.store.ict,displayField:"ict",valueField:"id",plugins:new b.ictCombo(),typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_instructional_component_UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(l,i){var k=Ext.getCmp("combo-subICT-"+d);if(l.getValue()===""){k.clearValue();k.hide()}else{k.clearValue();k.store.filter("parentICT",l.getValue());var j=k.store.getById(l.getValue()+"*");if(Ext.isEmpty(j)){k.setValue(l.getValue());k.hide()}else{k.setValue(l.getValue()+"*");k.show()}}}}}},{xtype:"combo",fieldLabel:"Sub ICT",hiddenName:"ict",width:h,listWidth:e,id:"combo-subICT-"+d,mode:"local",store:c.filter.store.subict,displayField:"ict",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:"Select a Sub ICT...",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"},{xtype:"combo",id:"combo-special-"+d,fieldLabel:"Special Filters",hiddenName:"special",width:h,listWidth:e,mode:"local",store:c.filter.store.special,displayField:"special",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.resource.special.selector.UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};b.rowExpander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate(_("search.resource.resource.expanded.title"),"<ul>",'<tpl for="parents">','<li class="resource-{assetType} category-{category} subcategory-{category}_{subcategory}">','<a href="{[this.getParentURL(values)]}" ext:qtip="{[this.getQtip(values)]}">',"{title}","</a>","</li>","</tpl>","</ul>",{getParentURL:function(i){var j=i.page||false;if(j){return"/xwiki/bin/view/"+j.replace(/\./,"/")}else{return""}},getQtip:function(i){var l=Curriki.module.search.data.resource.filter;var m=Ext.util.Format.stripTags(i.description||"");m=Ext.util.Format.ellipsis(m,256);m=Ext.util.Format.htmlEncode(m);var k=Curriki.data.fw_item.getRolloverDisplay(i.fwItems||[]);var j=Curriki.data.el.getRolloverDisplay(i.levels||[]);return String.format("{1}<br />{0}<br /><br />{3}<br />{2}<br />{5}<br />{4}",m,_("global.title.popup.description"),k,_("global.title.popup.subject"),j,_("global.title.popup.educationlevel"))}})});b.rowExpander.renderer=function(k,l,j){var i;if(j.data.parents&&j.data.parents.size()>0){l.cellAttr='rowspan="2"';i="x-grid3-row-expander";return String.format('<img class="{0}" src="{1}" ext:qtip="{2}" />',i,Ext.BLANK_IMAGE_URL,_("search.resource.icon.plus.rollover"))}else{i="x-grid3-row-expander-empty";return String.format('<img class="{0}" src="{1}" />',i,Ext.BLANK_IMAGE_URL)}};b.rowExpander.on("expand",function(n,k,j,i){var m=n.grid.view.getRow(i);var l=Ext.DomQuery.selectNode("img[class*=x-grid3-row-expander]",m);Ext.fly(l).set({"ext:qtip":_("search.resource.icon.minus.rollover")})});b.rowExpander.on("collapse",function(n,k,j,i){var m=n.grid.view.getRow(i);var l=Ext.DomQuery.selectNode("img[class*=x-grid3-row-expander]",m);Ext.fly(l).set({"ext:qtip":_("search.resource.icon.plus.rollover")})});b.columnModel=new Ext.grid.ColumnModel([Ext.apply(b.rowExpander,{id:"score",tooltip:_("search.resource.column.header.score.tooltip"),header:" ",dataIndex:"score",width:30,sortable:true}),{id:"title",header:_("search.resource.column.header.title"),width:164,dataIndex:"title",sortable:true,hideable:false,renderer:c.renderer.title},{id:"ict",width:108,header:_("search.resource.column.header.ict"),dataIndex:"ictText",sortable:true,renderer:c.renderer.ict},{id:"contributor",width:110,header:_("search.resource.column.header.contributor"),dataIndex:"contributor",sortable:true,renderer:c.renderer.contributor},{id:"rating",width:88,header:_("search.resource.column.header.rating"),dataIndex:"rating",sortable:true,renderer:c.renderer.rating},{id:"memberRating",width:105,header:_("search.resource.column.header.member.rating"),dataIndex:"memberRating",sortable:true,renderer:c.renderer.memberRating},{id:"updated",width:80,header:_("search.resource.column.header.updated"),dataIndex:"updated",hidden:true,sortable:true,renderer:c.renderer.updated}]);b.resultsPanel={xtype:"grid",id:"search-results-"+d,border:false,autoHeight:true,width:a.settings.gridWidth,autoExpandColumn:"title",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:c.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:b.columnModel,loadMask:false,plugins:b.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+d,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:c.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+d),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};b.mainPanel={xtype:"panel",id:"search-panel-"+d,autoHeight:true,items:[b.filterPanel,b.resultsPanel]};b.doSearch=function(){a.util.doSearch(d)};a.util.registerTabTitleListener(d)};Ext.onReady(function(){b.init()})})();(function(){var b="group";Ext.ns("Curriki.module.search.data."+b);var a=Curriki.module.search.data.group;a.init=function(){console.log("data."+b+": init");a.filter={};var c=a.filter;c.data={};c.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("XWiki.CurrikiSpaceClass_topic_FW_masterFramework.WebHome.UNSPECIFIED")]]};c.data.subject.mapping.each(function(d){c.data.subject.list.push(d.id)});c.data.subject.list.each(function(d){c.data.subject.data.push([d,_("XWiki.CurrikiSpaceClass_topic_"+d)])});c.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};c.data.subject.mapping.each(function(d){c.data.subsubject.data.push([d.id,_("XWiki.CurrikiSpaceClass_topic_"+d.id+".UNSPECIFIED"),d.id]);c.data.subsubject.mapping[d.id].each(function(e){c.data.subsubject.data.push([e.id,_("XWiki.CurrikiSpaceClass_topic_"+e.id),d.id])})});c.data.level={list:Curriki.data.el.list,data:[["",_("XWiki.CurrikiSpaceClass_educationLevel_UNSPECIFIED")]]};c.data.level.list.each(function(d){c.data.level.data.push([d,_("XWiki.CurrikiSpaceClass_educationLevel_"+d)])});c.data.policy={list:["open","closed"],data:[["",_("search.XWiki.SpaceClass_policy_UNSPECIFIED")]]};c.data.policy.list.each(function(d){c.data.policy.data.push([d,_("search.XWiki.SpaceClass_policy_"+d)])});c.data.language={list:Curriki.data.language.list,data:[["",_("XWiki.CurrikiSpaceClass_language_UNSPECIFIED")]]};c.data.language.list.each(function(d){c.data.language.data.push([d,_("XWiki.CurrikiSpaceClass_language_"+d)])});c.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:c.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:c.data.subsubject.data,id:0}),level:new Ext.data.SimpleStore({fields:["id","level"],data:c.data.level.data,id:0}),policy:new Ext.data.SimpleStore({fields:["id","policy"],data:c.data.policy.data,id:0}),language:new Ext.data.SimpleStore({fields:["id","language"],data:c.data.language.data,id:0})};a.store={};a.store.record=new Ext.data.Record.create([{name:"title"},{name:"url"},{name:"policy"},{name:"description"},{name:"updated"}]);a.store.results=new Ext.data.Store({storeId:"search-store-"+b,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Groups",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},a.store.record),remoteSort:true});a.store.results.setDefaultSort("title","asc");a.renderer={title:function(h,g,d,i,f,e){return String.format('<a href="{0}">{1}</a>',d.data.url,h)},policy:function(h,g,d,j,f,e){if(h!==""){g.css="policy-"+h}var i=_("search.group.icon."+h);return String.format('<span ext:qtip="{1}">{0}</span>',i,_("search.group.icon."+h+".rollover"))},description:function(h,g,d,j,f,e){var i=Ext.util.Format.htmlDecode(h);i=Ext.util.Format.stripScripts(h);i=Ext.util.Format.stripTags(i);i=Ext.util.Format.ellipsis(i,128);i=Ext.util.Format.htmlEncode(i);i=Ext.util.Format.trim(i);return String.format("{0}",i)},updated:function(i,g,d,j,f,e){var h=Ext.util.Format.date(i,"M-d-Y");return String.format("{0}",h)}}};Ext.onReady(function(){a.init()})})();(function(){var d="group";Ext.ns("Curriki.module.search.form."+d);var a=Curriki.module.search;var b=a.form[d];var c=a.data[d];b.init=function(){console.log("form."+d+": init");var f=140;var e=250;b.termPanel=a.util.createTermPanel(d,b);b.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+d,formId:"search-filterForm-"+d,border:false,items:[b.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+d,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:a.util.fieldsetPanelSave},staterestore:{fn:a.util.fieldsetPanelRestore},expand:{fn:function(g){Ext.getCmp("search-results-"+d).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+d).setWidth(f);Ext.getCmp("search-termPanel-"+d).el.repaint()}},collapse:{fn:function(g){Ext.getCmp("search-results-"+d).getView().refresh();Ext.getCmp("search-termPanel-"+d).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",fieldLabel:"Subject",id:"combo-subject-"+d,hiddenName:"subjectparent",width:f,listWidth:e,mode:"local",store:c.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_topic_FW_masterFramework.WebHome.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(i,h){var g=Ext.getCmp("combo-subsubject-"+d);if(i.getValue()===""){g.clearValue();g.hide()}else{g.show();g.clearValue();g.store.filter("parentItem",i.getValue());g.setValue(i.getValue())}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+d,hiddenName:"subject",width:f,listWidth:e,mode:"local",store:c.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-level-"+d,fieldLabel:"Level",mode:"local",width:f,listWidth:e,store:c.filter.store.level,hiddenName:"level",displayField:"level",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_educationLevel_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-language-"+d,fieldLabel:"Language",hiddenName:"language",mode:"local",width:f,listWidth:e,store:c.filter.store.language,displayField:"language",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_language_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-policy-"+d,fieldLabel:"Membership Policy",hiddenName:"policy",mode:"local",width:f,listWidth:e,store:c.filter.store.policy,displayField:"policy",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.XWiki.SpaceClass_policy_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};b.columnModel=new Ext.grid.ColumnModel([{id:"policy",header:_("search.group.column.header.policy"),width:62,dataIndex:"policy",sortable:true,renderer:c.renderer.policy},{id:"title",header:_("search.group.column.header.name"),width:213,dataIndex:"title",sortable:true,hideable:false,renderer:c.renderer.title},{id:"description",width:225,header:_("search.group.column.header.description"),dataIndex:"description",sortable:false,renderer:c.renderer.description},{id:"updated",width:96,header:_("search.group.column.header.updated"),dataIndex:"updated",sortable:true,renderer:c.renderer.updated}]);b.resultsPanel={xtype:"grid",id:"search-results-"+d,border:false,autoHeight:true,width:a.settings.gridWidth,autoExpandColumn:"description",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:c.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:b.columnModel,loadMask:false,plugins:b.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+d,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:c.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+d),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};b.mainPanel={xtype:"panel",id:"search-panel-"+d,autoHeight:true,items:[b.filterPanel,b.resultsPanel]};b.doSearch=function(){a.util.doSearch(d)};a.util.registerTabTitleListener(d)};Ext.onReady(function(){b.init()})})();(function(){var b="member";Ext.ns("Curriki.module.search.data."+b);var a=Curriki.module.search.data.member;a.init=function(){console.log("data."+b+": init");a.filter={};var c=a.filter;c.data={};c.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("XWiki.XWikiUsers_topics_FW_masterFramework.WebHome.UNSPECIFIED")]]};c.data.subject.mapping.each(function(d){c.data.subject.list.push(d.id)});c.data.subject.list.each(function(d){c.data.subject.data.push([d,_("XWiki.XWikiUsers_topics_"+d)])});c.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};c.data.subject.mapping.each(function(d){c.data.subsubject.data.push([d.id,_("XWiki.XWikiUsers_topics_"+d.id+".UNSPECIFIED"),d.id]);c.data.subsubject.mapping[d.id].each(function(e){c.data.subsubject.data.push([e.id,_("XWiki.XWikiUsers_topics_"+e.id),d.id])})});c.data.country={list:"AD|AE|AF|AG|AI|AL|AM|AN|AO|AQ|AR|AS|AT|AU|AW|AX|AZ|BA|BB|BD|BE|BF|BG|BH|BI|BJ|BM|BN|BO|BR|BS|BT|BV|BW|BY|BZ|CA|CC|CD|CF|CG|CH|CI|CK|CL|CM|CN|CO|CR|CU|CV|CX|CY|CZ|DE|DJ|DK|DM|DO|DZ|EC|EE|EG|EH|ER|ES|ET|FI|FJ|FK|FM|FO|FR|GA|GB|GD|GE|GF|GG|GH|GI|GL|GM|GN|GP|GQ|GR|GS|GT|GU|GW|GY|HK|HM|HN|HR|HT|HU|ID|IE|IL|IM|IN|IO|IQ|IR|IS|IT|JE|JM|JO|JP|KE|KG|KH|KI|KM|KN|KP|KR|KW|KY|KZ|LA|LB|LC|LI|LK|LR|LS|LT|LU|LV|LY|MA|MC|MD|ME|MG|MH|MK|ML|MM|MN|MO|MP|MQ|MR|MS|MT|MU|MV|MW|MX|MY|MZ|NA|NC|NE|NF|NG|NI|NL|NO|NP|NR|NU|NZ|OM|PA|PE|PF|PG|PH|PK|PL|PM|PN|PR|PS|PT|PW|PY|QA|RE|RO|RS|RU|RW|SA|SB|SC|SD|SE|SG|SH|SI|SJ|SK|SL|SM|SN|SO|SR|ST|SV|SY|SZ|TC|TD|TF|TG|TH|TJ|TK|TL|TM|TN|TO|TR|TT|TV|TW|TZ|UA|UG|UM|US|UY|UZ|VA|VC|VE|VG|VI|VN|VU|WF|WS|YE|YT|ZA|ZM|ZW".split("|"),data:[["",_("XWiki.XWikiUsers_country_UNSPECIFIED")]]};c.data.country.list.each(function(d){c.data.country.data.push([d,_("XWiki.XWikiUsers_country_"+d)])});c.data.member_type={list:["student","parent","professional","teacher","administration"],data:[["",_("XWiki.XWikiUsers_member_type_UNSPECIFIED")]]};c.data.member_type.list.each(function(d){c.data.member_type.data.push([d,_("XWiki.XWikiUsers_member_type_"+d)])});c.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:c.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:c.data.subsubject.data,id:0}),member_type:new Ext.data.SimpleStore({fields:["id","member_type"],data:c.data.member_type.data,id:0}),country:new Ext.data.SimpleStore({fields:["id","country"],data:c.data.country.data,id:0})};a.store={};a.store.record=new Ext.data.Record.create([{name:"name1"},{name:"name2"},{name:"url"},{name:"bio"},{name:"picture"},{name:"contributions"}]);a.store.results=new Ext.data.Store({storeId:"search-store-"+b,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Members",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},a.store.record),remoteSort:true});a.store.results.setDefaultSort("name1","asc");a.renderer={name1:function(h,g,d,i,f,e){return String.format('<a href="{1}">{0}</a>',h,d.data.url)},name2:function(h,g,d,i,f,e){return String.format('<a href="{1}">{0}</a>',h,d.data.url)},picture:function(h,g,d,i,f,e){return String.format('<a href="{2}"><img src="{0}" alt="{1}" class="member-picture" style="width:88px" /></a>',h,_("search.member.column.picture.alt.text"),d.data.url)},contributions:function(h,g,d,i,f,e){return String.format("{0}",h)},bio:function(h,g,d,j,f,e){var i=Ext.util.Format.htmlDecode(h);i=Ext.util.Format.stripScripts(h);i=Ext.util.Format.stripTags(i);i=Ext.util.Format.ellipsis(i,128);i=Ext.util.Format.htmlEncode(i);i=Ext.util.Format.trim(i);return String.format("{0}",i)}}};Ext.onReady(function(){a.init()})})();(function(){var d="member";Ext.ns("Curriki.module.search.form."+d);var a=Curriki.module.search;var b=a.form[d];var c=a.data[d];b.init=function(){console.log("form."+d+": init");var f=140;var e=250;b.termPanel=a.util.createTermPanel(d,b);b.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+d,formId:"search-filterForm-"+d,border:false,items:[b.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+d,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:a.util.fieldsetPanelSave},staterestore:{fn:a.util.fieldsetPanelRestore},expand:{fn:function(g){Ext.getCmp("search-results-"+d).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+d).setWidth(f);Ext.getCmp("search-termPanel-"+d).el.repaint()}},collapse:{fn:function(g){Ext.getCmp("search-results-"+d).getView().refresh();Ext.getCmp("search-termPanel-"+d).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-subject-"+d,fieldLabel:"Subject",hiddenName:"subjectparent",width:f,listWidth:e,mode:"local",store:c.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_topics_FW_masterFramework.WebHome.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(i,h){var g=Ext.getCmp("combo-subsubject-"+d);if(i.getValue()===""){g.clearValue();g.hide()}else{g.show();g.clearValue();g.store.filter("parentItem",i.getValue());g.setValue(i.getValue())}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+d,hiddenName:"subject",width:f,listWidth:e,mode:"local",store:c.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-member_type-"+d,fieldLabel:"Member Type",mode:"local",width:f,listWidth:e,store:c.filter.store.member_type,hiddenName:"member_type",displayField:"member_type",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_member_type_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-country-"+d,fieldLabel:"Country",hiddenName:"country",width:f,listWidth:e,mode:"local",store:c.filter.store.country,displayField:"country",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_country_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};b.columnModelList=[{id:"picture",header:_("search.member.column.header.picture"),width:116,dataIndex:"picture",sortable:false,resizable:false,menuDisabled:true,renderer:c.renderer.picture},{id:"name1",header:_("search.member.column.header.name1"),width:120,dataIndex:"name1",sortable:true,hideable:false,renderer:c.renderer.name1},{id:"name2",width:120,header:_("search.member.column.header.name2"),dataIndex:"name2",sortable:true,hideable:false,renderer:c.renderer.name2},{id:"bio",width:120,header:_("search.member.column.header.bio"),dataIndex:"bio",sortable:false,renderer:c.renderer.bio},{id:"contributions",width:120,header:_("search.member.column.header.contributions"),dataIndex:"contributions",sortable:false,renderer:c.renderer.contributions}];b.columnModel=new Ext.grid.ColumnModel(b.columnModelList);b.resultsPanel={xtype:"grid",id:"search-results-"+d,border:false,autoHeight:true,width:a.settings.gridWidth,autoExpandColumn:"bio",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:c.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:b.columnModel,loadMask:false,plugins:b.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+d,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:c.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+d),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};b.mainPanel={xtype:"panel",id:"search-panel-"+d,autoHeight:true,items:[b.filterPanel,b.resultsPanel]};b.doSearch=function(){a.util.doSearch(d)};a.util.registerTabTitleListener(d)};Ext.onReady(function(){b.init()})})();(function(){var b="blog";Ext.ns("Curriki.module.search.data."+b);var a=Curriki.module.search.data.blog;a.init=function(){console.log("data."+b+": init");a.store={};a.store.record=new Ext.data.Record.create([{name:"name"},{name:"title"},{name:"text"},{name:"comments"},{name:"updated"},{name:"memberUrl"},{name:"blogUrl"}]);a.store.results=new Ext.data.Store({storeId:"search-store-"+b,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Blogs",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},a.store.record),remoteSort:true});a.store.results.setDefaultSort("updated","desc");a.renderer={name:function(g,f,c,h,e,d){return String.format('<a href="{1}">{0}</a>',g,c.data.memberUrl)},text:function(g,f,c,i,e,d){var h=Ext.util.Format.htmlDecode(g);h=Ext.util.Format.stripScripts(g);h=Ext.util.Format.stripTags(h);h=Ext.util.Format.trim(h);h=Ext.util.Format.ellipsis(h,128);return String.format('<a href="{2}" class="search-blog-title">{1}</a><br /><br />{0}',h,c.data.title,c.data.blogUrl)},comments:function(g,f,c,h,e,d){return String.format("{0}",g)},updated:function(h,f,c,i,e,d){var g=Ext.util.Format.date(h,"M-d-Y");return String.format("{0}",g)}}};Ext.onReady(function(){a.init()})})();(function(){var d="blog";Ext.ns("Curriki.module.search.form."+d);var a=Curriki.module.search;var b=a.form[d];var c=a.data[d];b.init=function(){console.log("form."+d+": init");b.termPanel=a.util.createTermPanel(d,b);b.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+d,formId:"search-filterForm-"+d,border:false,items:[b.termPanel]};b.columnModel=new Ext.grid.ColumnModel([{id:"name",header:_("search.blog.column.header.name"),width:160,dataIndex:"name",sortable:true,renderer:c.renderer.name},{id:"text",header:_("search.blog.column.header.text"),width:260,dataIndex:"text",sortable:false,renderer:c.renderer.text},{id:"comments",header:_("search.blog.column.header.comments"),width:80,dataIndex:"comments",sortable:false,renderer:c.renderer.comments},{id:"updated",width:96,header:_("search.blog.column.header.updated"),dataIndex:"updated",sortable:true,renderer:c.renderer.updated}]);b.resultsPanel={xtype:"grid",id:"search-results-"+d,border:false,autoHeight:true,width:a.settings.gridWidth,autoExpandColumn:"text",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:c.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:b.columnModel,loadMask:false,bbar:new Ext.PagingToolbar({id:"search-pager-"+d,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:c.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+d),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};b.mainPanel={xtype:"panel",id:"search-panel-"+d,autoHeight:true,items:[b.filterPanel,b.resultsPanel]};b.doSearch=function(){a.util.doSearch(d)};a.util.registerTabTitleListener(d)};Ext.onReady(function(){b.init()})})();(function(){var b="curriki";Ext.ns("Curriki.module.search.data."+b);var a=Curriki.module.search.data.curriki;a.init=function(){console.log("data."+b+": init");a.store={};a.store.record=new Ext.data.Record.create([{name:"name"},{name:"updated"},{name:"url"}]);a.store.results=new Ext.data.Store({storeId:"search-store-"+b,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Curriki",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount"},a.store.record),remoteSort:true});a.store.results.setDefaultSort("name","asc");a.renderer={name:function(g,f,c,h,e,d){return String.format('<a href="{1}">{0}</a>',g,c.data.url)},updated:function(h,f,c,i,e,d){var g=Ext.util.Format.date(h,"M-d-Y");return String.format("{0}",g)}}};Ext.onReady(function(){a.init()})})();(function(){var d="curriki";Ext.ns("Curriki.module.search.form."+d);var a=Curriki.module.search;var b=a.form[d];var c=a.data[d];b.init=function(){console.log("form."+d+": init");b.termPanel=a.util.createTermPanel(d,b);b.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+d,formId:"search-filterForm-"+d,border:false,items:[b.termPanel]};b.columnModel=new Ext.grid.ColumnModel([{id:"name",header:_("search.curriki.column.header.name"),width:500,dataIndex:"name",sortable:true,renderer:c.renderer.name},{id:"updated",width:96,header:_("search.curriki.column.header.updated"),dataIndex:"updated",sortable:true,renderer:c.renderer.updated}]);b.resultsPanel={xtype:"grid",id:"search-results-"+d,border:false,autoHeight:true,width:a.settings.gridWidth,autoExpandColumn:"name",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:c.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:b.columnModel,loadMask:false,bbar:new Ext.PagingToolbar({id:"search-pager-"+d,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:c.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+d),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};b.mainPanel={xtype:"panel",id:"search-panel-"+d,autoHeight:true,items:[b.filterPanel,b.resultsPanel]};b.doSearch=function(){a.util.doSearch(d)};a.util.registerTabTitleListener(d)};Ext.onReady(function(){b.init()})})();(function(){Ext.ns("Curriki.module.search.form");var b=Curriki.module.search;var a=b.form;var c="No concurrent searches on same tab.";b.init=function(){console.log("search: init");if(Ext.isEmpty(b.initialized)){if(Ext.isEmpty(b.tabList)){b.tabList=["resource","group","member","curriki"]}var e=140;b.doSearch=function(k,i,j){var g={};if(Ext.getCmp("search-termPanel")&&Ext.getCmp("search-termPanel").getForm){g.all=Ext.getCmp("search-termPanel").getForm().getValues(false)}var l={};var f={};Ext.each(b.tabList,function(t){var s=a[t];if(!Ext.isEmpty(s)&&!Ext.isEmpty(s.doSearch)){var r=Ext.getCmp("search-filterPanel-"+t);if(!Ext.isEmpty(r)){var u=r.getForm();if(!Ext.isEmpty(u)){g[t]=u.getValues(false);if("undefined"!==typeof g[t]["terms"]&&g[t]["terms"]===_("search.text.entry.label")){delete (g[t]["terms"])}if("undefined"!==typeof g[t]["other"]&&g[t]["other"]===""){delete (g[t]["other"])}if(Ext.StoreMgr.lookup("search-store-"+t).sortInfo){g[t]["sort"]=new Object();g[t]["sort"].field=Ext.StoreMgr.lookup("search-store-"+t).sortInfo.field;g[t]["sort"].dir=Ext.StoreMgr.lookup("search-store-"+t).sortInfo.direction}}}var p=Ext.getCmp("search-advanced-"+t);if(!Ext.isEmpty(p)){if(!p.collapsed){f[t]={a:true}}}var q=Ext.getCmp("search-pager-"+t);if(!Ext.isEmpty(q)){var v={};v.c=(("undefined"===typeof i)||(i!==true))?q.cursor:0;v.s=q.pageSize;l[t]=v}if((("undefined"===typeof j)||(j=false))&&(Ext.isEmpty(k)||k===t)){if(Curriki.numSearches>10){return}Curriki.numSearches++;console.log("now util.doSearch ("+window.numSearches+")",t,l);b.util.doSearch(t,(("undefined"!==typeof l[t])?l[t].c:0))}}});Curriki.numSearches=0;var o={};o.s=Ext.isEmpty(k)?"all":k;o.f=g;o.p=l;if(Ext.getCmp("search-tabPanel").getActiveTab){o.t=Ext.getCmp("search-tabPanel").getActiveTab().id}o.a=f;var m=new Ext.state.Provider();var n=m.encodeValue(o);console.log("Saving History: "+n);if(b.history.lastHistoryToken||window.currikiHistoryStarted){b.history.setLastToken(n);var h=Ext.History.add(n,true);if(h){console.log("-- created a new history frame.")}}else{window.currikiHistoryStarted=true;b.history.setLastToken(n);window.top.location.replace(window.location.pathname+"#"+n);console.log("-- rather replaced history.")}};b.tabPanel={xtype:(b.tabList.size()>1?"tab":"")+"panel",id:"search-tabPanel",activeTab:0,deferredRender:false,autoHeight:true,layoutOnTabChange:true,frame:false,border:false,plain:true,defaults:{autoScroll:false,border:false},listeners:{tabchange:function(i,h){var g=h.id.replace(/(^search-|-tab$)/g,"");Curriki.logView("/features/search/"+g);var f=Ext.getCmp("search-advanced-"+g);if(!Ext.isEmpty(f)){if(!f.collapsed){Ext.select(".x-form-field-wrap",false,"search-advanced-"+g).setWidth(e)}}}},items:[]};Ext.each(b.tabList,function(f){panel={title:_("search."+f+".tab.title"),id:"search-"+f+"-tab",cls:"search-"+f,autoHeight:true};module=a[f];if(!Ext.isEmpty(module)&&!Ext.isEmpty(module.mainPanel)){panel.items=[module.mainPanel];b.tabPanel.items.push(panel)}});b.mainPanel={el:"search-div",border:false,height:"600px",defaults:{border:false},cls:"search-module",items:[b.tabPanel]};Ext.ns("Curriki.module.search.history");var d=b.history;d.lastHistoryToken=false;d.historyChange=function(f){if(f){if(f==d.lastHistoryToken){}else{d.updateFromHistory(f)}}else{}};d.setLastToken=function(f){d.lastHistoryToken=f};d.updateFromHistory=function(g){var k=new Ext.state.Provider();var f=k.decodeValue(g);if(d.lastHistoryToken==g||escape(d.lastHistoryToken)==g){return}console.log("Got History: "+g,{values:f});if(!Ext.isEmpty(f)){var j=f.f;if(!Ext.isEmpty(j)&&j.all&&Ext.getCmp("search-termPanel")&&Ext.getCmp("search-termPanel").getForm){Ext.getCmp("search-termPanel").getForm().setValues(j.all)}var h=f.p;var i=f.a;if(f.t){if(Ext.getCmp("search-tabPanel").setActiveTab){Ext.getCmp("search-tabPanel").setActiveTab(f.t)}}Ext.each(b.tabList,function(m){console.log("Updating "+m);var l=b.form[m];if(!Ext.isEmpty(l)&&!Ext.isEmpty(l.doSearch)&&!Ext.isEmpty(j)&&!Ext.isEmpty(j[m])){var r=Ext.getCmp("search-filterPanel-"+m);if(!Ext.isEmpty(r)){var n=r.getForm();if(!Ext.isEmpty(n)){try{n.setValues(j[m]);var p=Ext.getCmp("combo-subject-"+m);if(p){p.fireEvent("select",p,p.getValue());if(!Ext.isEmpty(j[m].subject)){if(Ext.getCmp("combo-subsubject-"+m)){Ext.getCmp("combo-subsubject-"+m).setValue(j[m].subject)}}}p=Ext.getCmp("combo-ictprfx-"+m);if(p){p.fireEvent("select",p,p.getValue());if(!Ext.isEmpty(j[m].ict)){if(Ext.getCmp("combo-subICT-"+m)){Ext.getCmp("combo-subICT-"+m).setValue(j[m].ict)}}}if(j[m]["sort"]){var t=j[m]["sort"];if(t.field){Ext.StoreMgr.lookup("search-store-"+m).sortInfo.field=t.field}if(t.dir){Ext.StoreMgr.lookup("search-store-"+m).sortInfo.direction=t.dir}}}catch(o){console.log("ERROR Updating "+m,o)}}}if(!Ext.isEmpty(i)&&!Ext.isEmpty(i[m])&&i[m].a){var q=Ext.getCmp("search-advanced-"+m);if(!Ext.isEmpty(q)){q.expand(false)}}var s=Ext.getCmp("search-pager-"+m);if(!Ext.isEmpty(s)&&!Ext.isEmpty(h)){if(h[m]){try{if(h[m]["c"]){s.cursor=h[m]["c"]}if(h[m]["s"]){if(s.pageSize!=h[m]["s"]){s.setPageSize(h[m]["s"])}}}catch(o){console.log("ERROR Updating "+m,o)}}}}});if(f.s){console.log("Starting search");if(f.s==="all"){b.doSearch()}else{b.doSearch(f.s)}}d.setLastToken(g)}};d.init=function(){if(Ext.isEmpty(d.initialized)){var f=Ext.History.getToken();Ext.History.init(function(){Ext.History.on("change",d.historyChange);if(f){d.historyChange(f)}});d.initialized=true}};b.initialized=true;console.log("search: init done")}};b.display=function(){b.init();var d=new Ext.Panel(b.mainPanel);d.render();b.history.init()};b.start=function(){Ext.onReady(function(){b.display()})}})();