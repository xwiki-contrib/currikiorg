Array.prototype.contains=function(A){return this.indexOf(A)!==-1};Ext.namespace("Ext.ux");Ext.ux.DDView=function(B){if(!B.itemSelector){var A=B.tpl;if(this.classRe.test(A)){B.tpl=A.replace(this.classRe,"class=$1x-combo-list-item $2$1")}else{B.tpl=A.replace(this.tagRe,'$1 class="x-combo-list-item" $2')}B.itemSelector=".x-combo-list-item"}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(B,{border:false}))};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))}if(this.deletable){this.setDeletable()}this.isDirtyFlag=false;this.addEvents("drop")},validate:function(){return true},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()}}},getName:function(){return this.name},setValue:function(A){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"}var B={};B[this.store.reader.meta.root]=A?[].concat(A):[];this.store.proxy=new Ext.data.MemoryProxy(B);this.store.load()},getValue:function(){var A="(";this.store.each(function(B){A+=B.id+","});return A.substr(0,A.length-1)+")"},getIds:function(){var B=0,A=new Array(this.store.getCount());this.store.each(function(C){A[B++]=C.id});return A},isDirty:function(){return this.isDirtyFlag},getTargetFromEvent:function(B){var A=B.getTarget();while((A!==null)&&(A.parentNode!=this.el.dom)){A=A.parentNode}if(!A){A=this.el.dom.lastChild||this.el.dom}return A},getDragData:function(D){var C=this.findItemFromChild(D.getTarget());if(C){if(!this.isSelected(C)){delete this.ignoreNextClick;this.onItemClick(C,this.indexOf(C),D);this.ignoreNextClick=true}var B={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&D.ctrlKey)};if(this.getSelectionCount()==1){var A=this.getSelectedIndexes()[0];var E=this.getNode(A);B.viewNodes.push(B.ddel=E);B.records.push(this.store.getAt(A));B.repairXY=Ext.fly(E).getXY()}else{B.ddel=document.createElement("div");B.ddel.className="multi-proxy";this.collectSelection(B)}return B}return false},getRepairXY:function(A){return this.dragData.repairXY},collectSelection:function(B){B.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(C){var E=this.getNode(C);var D=E.cloneNode(true);D.id=Ext.id();B.ddel.appendChild(D);B.records.push(this.store.getAt(C));B.viewNodes.push(E)},this)}else{var A=0;this.store.each(function(D){if(this.isSelected(A)){var E=this.getNode(A);var C=E.cloneNode(true);C.id=Ext.id();B.ddel.appendChild(C);B.records.push(this.store.getAt(A));B.viewNodes.push(E)}A++},this)}},setDraggable:function(A){if(A instanceof Array){Ext.each(A,this.setDraggable,this);return }if(this.dragZone){this.dragZone.addToGroup(A)}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:A});if(!this.multiSelect){this.singleSelect=true}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag}},setDroppable:function(A){if(A instanceof Array){Ext.each(A,this.setDroppable,this);return }if(this.dropZone){this.dropZone.addToGroup(A)}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:A});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)}},getDropPoint:function(D,G,B){if(G==this.el.dom){return"above"}var C=Ext.lib.Dom.getY(G),A=C+G.offsetHeight;var F=C+(A-C)/2;var E=Ext.lib.Event.getPageY(D);if(E<=F){return"above"}else{return"below"}},isValidDropPoint:function(B,D,A){if(!A.viewNodes||(A.viewNodes.length!=1)){return true}var C=A.viewNodes[0];if(C==D){return false}if((B=="below")&&(D.nextSibling==C)){return false}if((B=="above")&&(D.previousSibling==C)){return false}return true},onNodeEnter:function(D,A,C,B){if(this.highlightColor&&(B.sourceView!=this)){this.el.highlight(this.highlightColor)}return false},onNodeOver:function(G,A,F,D){var B=this.dropNotAllowed;var E=this.getDropPoint(F,G,A);if(this.isValidDropPoint(E,G,D)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"}if(E){var C;if(E=="above"){B=G.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";C="x-view-drag-insert-above"}else{B=G.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";C="x-view-drag-insert-below"}if(this.lastInsertClass!=C){Ext.fly(G).replaceClass(this.lastInsertClass,C);this.lastInsertClass=C}}}return B},onNodeOut:function(D,A,C,B){this.removeDropIndicators(D)},onNodeDrop:function(C,I,G,E){if(this.fireEvent("drop",this,C,I,G,E)===false){return false}var J=this.getDropPoint(G,C,I);var D=(this.appendOnly||(C==this.el.dom))?this.store.getCount():C.viewIndex;if(J=="below"){D++}if(E.sourceView==this){if(J=="below"){if(E.viewNodes[0]==C){E.viewNodes.shift()}}else{if(E.viewNodes[E.viewNodes.length-1]==C){E.viewNodes.pop()}}if(!E.viewNodes.length){return false}if(D>this.store.indexOf(E.records[0])){D--}}if(E.node instanceof Ext.tree.TreeNode){var A=E.node.getOwnerTree().recordFromNode(E.node);if(A){E.records=[A]}}if(!E.records){alert("Programming problem. Drag data contained no Records");return false}for(var F=0;F<E.records.length;F++){var A=E.records[F];var B=this.store.getById(A.id);if(B&&(I!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(B))).frame("red",1);return true}var H=new Ext.data.Record();A.id=H.id;delete H}if(E.copy){this.store.insert(D++,A.copy())}else{if(E.sourceView){E.sourceView.isDirtyFlag=true;E.sourceView.store.remove(A)}if(!this.allowTrash){this.store.insert(D++,A)}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)}this.isDirtyFlag=true}this.dragZone.cachedTarget=null;return true},onEndDrag:function(A,B){var C=Ext.get(this.dragData.ddel);if(C&&C.hasClass("multi-proxy")){C.remove()}},removeDropIndicators:function(A){if(A){Ext.fly(A).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass"}},setDeletable:function(A){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true}var B=this.getContextMenu();this.contextMenu.on("itemclick",function(C){switch(C.id){case"delete":this.remove(this.getSelectedIndexes());break}},this);this.contextMenu.add({icon:A||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this)}return this.contextMenu},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)}},showContextMenu:function(B,A){A=this.findItemFromChild(B.getTarget());if(A){B.stopEvent();this.select(this.getNode(A),this.multiSelect&&B.ctrlKey,true);this.contextMenu.showAt(B.getXY())}},remove:function(B){B=[].concat(B);for(var A=0;A<B.length;A++){var C=this.store.getAt(B[A]);this.store.remove(C)}},onDblClick:function(E){var D=this.findItemFromChild(E.getTarget());if(D){if(this.fireEvent("dblclick",this,this.indexOf(D),D,E)===false){return false}if(this.dragGroup){var A=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(A.contains(this.dropZone)){A.remove(this.dropZone)}if((A.length==1)&&(A[0].owningView)){this.dragZone.cachedTarget=null;var B=Ext.get(A[0].getEl());var C=B.getBox(true);A[0].onNodeDrop(B.dom,{target:B.dom,xy:[C.x,C.y+C.height-1]},null,this.getDragData(E))}}}},onItemClick:function(B,A,C){if(this.ignoreNextClick){delete this.ignoreNextClick;return }if(this.fireEvent("beforeclick",this,A,B,C)===false){return false}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&C.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),A),false)}else{if(this.isSelected(B)&&C.ctrlKey){this.deselect(B)}else{this.deselect(B);this.select(B,this.multiSelect&&C.ctrlKey);this.lastSelection=B}}C.preventDefault()}return true}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({dblclick:true,click:true,change:true,drop:true})},onRender:function(E,B){var A,C,D;Ext.ux.Multiselect.superclass.onRender.call(this,E,B);C="ux-mselect";A=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});if(!this.legend){A.el.down("."+A.headerCls).remove()}A.body.addClass(C);D='<tpl for="."><div class="'+C+"-item";if(Ext.isIE||Ext.isIE7){D+='" unselectable=on'}else{D+=' x-unselectable"'}D+=">{"+this.displayField+"}</div></tpl>";if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:C+"-selected",tpl:D,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+C+"-item",isFormField:false,applyTo:A.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});A.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(H,K,G,J,I){return this.fireEvent("drop",H,K,G,J,I)},this);this.hiddenName=this.name;var F={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(F)}else{this.hiddenField=Ext.get(document.body).createChild(F)}A.doLayout()},initValue:Ext.emptyFn,onViewClick:function(D,B,C,E){var A=this.preClickSelections.indexOf(B);if(A!=-1){this.preClickSelections.splice(A,1);this.view.clearSelections(true);this.view.select(this.preClickSelections)}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,E);this.validate()},onViewBeforeClick:function(C,A,B,D){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false}},onViewDblClick:function(C,A,B,D){return this.fireEvent("dblclick",C,A,B,D)},getValue:function(A){var D=[];var C=this.view.getSelectedIndexes();if(C.length==0){return""}for(var B=0;B<C.length;B++){D.push(this.store.getAt(C[B]).get(((A!=null)?A:this.valueField)))}return D.join(this.delimiter)},setValue:function(A){var B;var D=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!A||(A=="")){return }if(!(A instanceof Array)){A=A.split(this.delimiter)}for(var C=0;C<A.length;C++){B=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+A[C]+"$","i")).itemAt(0));D.push(B)}this.view.select(D);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue("")},getRawValue:function(A){var B=this.getValue(A);if(B.length){B=B.split(this.delimiter)}else{B=[]}return B},setRawValue:function(A){setValue(A)},validateValue:function(A){if(A.length<1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(A.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(A.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true})},onRender:function(D,A){Ext.ux.ItemSelector.superclass.onRender.call(this,D,A);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var G=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});G.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var C=new Ext.Panel({header:false});G.add(C);G.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);G.render(this.el);C.el.down("."+C.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var F=C.getEl();if(!this.toSortField){this.toTopIcon=F.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});F.createChild({tag:"br"});this.upIcon=F.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});F.createChild({tag:"br"})}this.addIcon=F.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});F.createChild({tag:"br"});this.removeIcon=F.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});F.createChild({tag:"br"});if(!this.toSortField){this.downIcon=F.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});F.createChild({tag:"br"});this.toBottomIcon=F.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var B=G.body.first();this.el.setWidth(G.body.first().getWidth());G.body.removeClass();this.hiddenName=this.name;var E={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(E);this.valueChanged(this.toStore)},initValue:Ext.emptyFn,toTop:function(){var C=this.toMultiselect.view.getSelectedIndexes();var A=[];if(C.length>0){C.sort();for(var B=0;B<C.length;B++){record=this.toMultiselect.view.store.getAt(C[B]);A.push(record)}C=[];for(var B=A.length-1;B>-1;B--){record=A[B];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);C.push(((A.length-1)-B))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(C)},toBottom:function(){var C=this.toMultiselect.view.getSelectedIndexes();var A=[];if(C.length>0){C.sort();for(var B=0;B<C.length;B++){record=this.toMultiselect.view.store.getAt(C[B]);A.push(record)}C=[];for(var B=0;B<A.length;B++){record=A[B];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);C.push((this.toMultiselect.view.store.getCount())-(A.length-B))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(C)},up:function(){var A=null;var C=this.toMultiselect.view.getSelectedIndexes();C.sort();var D=[];if(C.length>0){for(var B=0;B<C.length;B++){A=this.toMultiselect.view.store.getAt(C[B]);if((C[B]-1)>=0){this.toMultiselect.view.store.remove(A);this.toMultiselect.view.store.insert(C[B]-1,A);D.push(C[B]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(D)}},down:function(){var A=null;var C=this.toMultiselect.view.getSelectedIndexes();C.sort();C.reverse();var D=[];if(C.length>0){for(var B=0;B<C.length;B++){A=this.toMultiselect.view.store.getAt(C[B]);if((C[B]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(A);this.toMultiselect.view.store.insert(C[B]+1,A);D.push(C[B]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(D)}},fromTo:function(){var D=this.fromMultiselect.view.getSelectedIndexes();var B=[];if(D.length>0){for(var C=0;C<D.length;C++){record=this.fromMultiselect.view.store.getAt(D[C]);B.push(record)}if(!this.allowDup){D=[]}for(var C=0;C<B.length;C++){record=B[C];if(this.allowDup){var A=new Ext.data.Record();record.id=A.id;delete A;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);D.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(D)}else{this.toMultiselect.view.select(D)}},toFrom:function(){var C=this.toMultiselect.view.getSelectedIndexes();var A=[];if(C.length>0){for(var B=0;B<C.length;B++){record=this.toMultiselect.view.store.getAt(C[B]);A.push(record)}C=[];for(var B=0;B<A.length;B++){record=A[B];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);C.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(C)},valueChanged:function(C){var A=null;var B=[];for(var D=0;D<C.getCount();D++){A=C.getAt(D);B.push(A.get(this.valueField))}this.hiddenField.dom.value=B.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value},onRowDblClick:function(C,A,B,D){return this.fireEvent("rowdblclick",C,A,B,D)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)}});Ext.reg("itemselector",Ext.ux.ItemSelector);Ext.namespace("Ext.ux.Andrie");Ext.ux.Andrie.pPageSize=function(A){Ext.apply(this,A)};Ext.extend(Ext.ux.Andrie.pPageSize,Ext.util.Observable,{beforeText:"Show",afterText:"items",addBefore:"-",addAfter:null,dynamic:false,variations:[5,10,20,50,100,200,500,1000],comboCfg:undefined,init:function(A){this.pagingToolbar=A;this.pagingToolbar.pageSizeCombo=this;this.pagingToolbar.setPageSize=this.setPageSize.createDelegate(this);this.pagingToolbar.getPageSize=function(){return this.pageSize};this.pagingToolbar.on("render",this.onRender,this)},addSize:function(A){if(A>0){this.sizes.push([A])}},updateStore:function(){if(this.dynamic){var B=this.pagingToolbar.pageSize,E;B=(B>0)?B:1;this.sizes=[];var C=this.variations;for(var D=0,A=C.length;D<A;D++){this.addSize(B-C[C.length-1-D])}this.addToStore(B);for(var D=0,A=C.length;D<A;D++){this.addSize(B+C[D])}}else{if(!this.staticSizes){this.sizes=[];var C=this.variations;var B=0;for(var D=0,A=C.length;D<A;D++){this.addSize(B+C[D])}this.staticSizes=this.sizes.slice(0)}else{this.sizes=this.staticSizes.slice(0)}}this.combo.store.loadData(this.sizes);this.combo.collapse();this.combo.setValue(this.pagingToolbar.pageSize)},setPageSize:function(E,H){var I=this.pagingToolbar;this.combo.collapse();E=parseInt(E)||parseInt(this.combo.getValue());E=(E>0)?E:1;if(E==I.pageSize){return }else{if(E<I.pageSize){I.pageSize=E;var A=Math.round(I.cursor/E)+1;var G=(A-1)*E;var F=I.store;if(G>F.getTotalCount()){this.pagingToolbar.pageSize=E;this.pagingToolbar.doLoad(G-E)}else{F.suspendEvents();for(var B=0,C=G-I.cursor;B<C;B++){F.remove(F.getAt(0))}while(F.getCount()>E){F.remove(F.getAt(F.getCount()-1))}F.resumeEvents();F.fireEvent("datachanged",F);I.cursor=G;var D=I.getPageData();I.afterTextEl.el.innerHTML=String.format(I.afterPageText,D.pages);I.field.dom.value=A;I.first.setDisabled(A==1);I.prev.setDisabled(A==1);I.next.setDisabled(A==D.pages);I.last.setDisabled(A==D.pages);I.updateInfo()}}else{this.pagingToolbar.pageSize=E;this.pagingToolbar.doLoad(Math.floor(this.pagingToolbar.cursor/this.pagingToolbar.pageSize)*this.pagingToolbar.pageSize)}}this.updateStore()},onRender:function(){this.combo=Ext.ComponentMgr.create(Ext.applyIf(this.comboCfg||{},{store:new Ext.data.SimpleStore({fields:["pageSize"],data:[]}),displayField:"pageSize",valueField:"pageSize",mode:"local",triggerAction:"all",width:50,xtype:"combo"}));this.combo.on("select",this.setPageSize,this);this.updateStore();if(this.addBefore){this.pagingToolbar.add(this.addBefore)}if(this.beforeText){this.pagingToolbar.add(this.beforeText)}this.pagingToolbar.add(this.combo);if(this.afterText){this.pagingToolbar.add(this.afterText)}if(this.addAfter){this.pagingToolbar.add(this.addAfter)}}});Ext.grid.RowExpander=function(A){Ext.apply(this,A);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}};Ext.extend(Ext.grid.RowExpander,Ext.util.Observable,{header:"",width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,getRowClass:function(A,E,D,C){D.cols=D.cols-1;var B=this.bodyContent[A.id];if(!B&&!this.lazyRender){B=this.getBodyContent(A,E)}if(B){D.body=B}return this.state[A.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(B){this.grid=B;var A=B.getView();A.getRowClass=this.getRowClass.createDelegate(this);A.enableRowBody=true;B.on("render",function(){A.mainBody.on("mousedown",this.onMouseDown,this)},this)},getBodyContent:function(A,B){if(!this.enableCaching){return this.tpl.apply(A.data)}var C=this.bodyContent[A.id];if(!C){C=this.tpl.apply(A.data);this.bodyContent[A.id]=C}return C},onMouseDown:function(B,A){if(A.className=="x-grid3-row-expander"){B.stopEvent();var C=B.getTarget(".x-grid3-row");this.toggleRow(C)}},renderer:function(B,C,A){C.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(B,A,C){if(this.fireEvent("beforeexpand",this,B,A,C)!==false){if(this.tpl&&this.lazyRender){A.innerHTML=this.getBodyContent(B,C)}return true}else{return false}},toggleRow:function(A){if(typeof A=="number"){A=this.grid.view.getRow(A)}this[Ext.fly(A).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](A)},expandRow:function(C){if(typeof C=="number"){C=this.grid.view.getRow(C)}var B=this.grid.store.getAt(C.rowIndex);var A=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",C);if(this.beforeExpand(B,A,C.rowIndex)){this.state[B.id]=true;Ext.fly(C).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,B,A,C.rowIndex)}},collapseRow:function(C){if(typeof C=="number"){C=this.grid.view.getRow(C)}var B=this.grid.store.getAt(C.rowIndex);var A=Ext.fly(C).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,B,A,C.rowIndex)!==false){this.state[B.id]=false;Ext.fly(C).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,B,A,C.rowIndex)}}});Ext.override(Ext.layout.FormLayout,{adjustWidthAnchor:function(B,A){return B-(A.isFormField?(A.hideLabel?0:this.labelAdjust):0)-A.el.getMargins("lr")}});Ext.override(Ext.layout.FormLayout,{getAnchorViewSize:function(A,B){return(A.body||A.el).getStyleSize()}});Ext.override(Ext.layout.AnchorLayout,{getAnchorViewSize:function(A,C){var B=A.body||A.el;return{width:B.dom.clientWidth-B.getPadding("lr"),height:B.dom.clientHeight-B.getPadding("tb")}},adjustWidthAnchor:function(B,A){return B-A.el.getMargins("lr")},adjustHeightAnchor:function(B,A){return B-A.el.getMargins("tb")}});Ext.override(Ext.Component,{saveState:function(){if(Ext.state.Manager&&this.stateful!==false){var A=this.getState();if(this.fireEvent("beforestatesave",this,A)!==false){Ext.state.Manager.set(this.stateId||this.id,A);this.fireEvent("statesave",this,A)}}},stateful:false});Ext.override(Ext.form.TriggerField,{onShow:function(){if(this.wrap){this.wrap.show()}},onHide:function(){this.wrap.hide()},onRender:function(B,A){Ext.form.TriggerField.superclass.onRender.call(this,B,A);this.wrap=this.el.wrap({cls:"x-form-field-wrap"});this.trigger=this.wrap.createChild(this.triggerConfig||{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(this.hideTrigger){this.trigger.setDisplayed(false)}this.initTrigger();if(!this.width){this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())}else{this.wrap.setWidth(this.width)}}});Ext.override(Ext.PagingToolbar,{onRender:function(B,A){Ext.PagingToolbar.superclass.onRender.call(this,B,A);this.first=this.addButton({tooltip:this.firstText,iconCls:"x-tbar-page-first",text:_("search.pagination.first.button"),disabled:true,handler:this.onClick.createDelegate(this,["first"])});this.prev=this.addButton({tooltip:this.prevText,iconCls:"x-tbar-page-prev",text:_("search.pagination.prev.button"),disabled:true,handler:this.onClick.createDelegate(this,["prev"])});this.addSeparator();this.add(this.beforePageText);this.field=Ext.get(this.addDom({tag:"input",type:"text",size:"3",value:"1",cls:"x-tbar-page-number"}).el);this.field.on("keydown",this.onPagingKeydown,this);this.field.on("focus",function(){this.dom.select()});this.afterTextEl=this.addText(String.format(this.afterPageText,1));this.field.setHeight(18);this.addSeparator();this.next=this.addButton({tooltip:this.nextText,iconCls:"x-tbar-page-next",text:_("search.pagination.next.button"),disabled:true,handler:this.onClick.createDelegate(this,["next"])});this.last=this.addButton({tooltip:this.lastText,iconCls:"x-tbar-page-last",text:_("search.pagination.last.button"),disabled:true,handler:this.onClick.createDelegate(this,["last"])});this.loading=this.addButton({hidden:true,tooltip:this.refreshText,iconCls:"x-tbar-loading",handler:this.onClick.createDelegate(this,["refresh"])});if(this.displayInfo){this.displayEl=Ext.fly(this.el.dom).createChild({cls:"x-paging-info"})}if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}}});Ext.override(Ext.ux.Andrie.pPageSize,{setPageSize:function(B,A){var C=this.pagingToolbar;this.combo.collapse();B=parseInt(B)||parseInt(this.combo.getValue());B=(B>0)?B:1;if(B==C.pageSize){return }else{this.pagingToolbar.pageSize=B;this.pagingToolbar.doLoad(Math.floor(this.pagingToolbar.cursor/this.pagingToolbar.pageSize)*this.pagingToolbar.pageSize)}this.updateStore()}});Ext.override(Ext.grid.GridView,{layout:function(){if(!this.mainBody){return }var C=this.grid;var F=C.getGridEl();var A=F.getSize(true);var B=A.width;if(B<20||A.height<20){return }if(C.autoHeight){this.scroller.dom.style.overflow="visible";this.scroller.dom.style.position="static"}else{this.el.setSize(A.width,A.height);var E=this.mainHd.getHeight();var D=A.height-(E);this.scroller.setSize(B,D);if(this.innerHd){this.innerHd.style.width=(B)+"px"}}if(this.forceFit){if(this.lastViewWidth!=B){this.fitColumns(false,false);this.lastViewWidth=B}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(B,D)}});Ext.BLANK_IMAGE_URL="/xwiki/skins/curriki8/extjs/resources/images/default/s.gif";Ext.Ajax.defaultHeaders={Accept:"application/json","Content-Type":"application/json; charset=utf-8"};Ext.Ajax.disableCaching=false;Ext.Ajax.timeout=120000;if(!("console" in window)||!("firebug" in console)){var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var i=0;i<names.length;++i){window.console[names[i]]=Ext.emptyFn}}console.log("initing Curriki");Ext.onReady(function(){Ext.QuickTips.init();if(Ext.isIE){Ext.apply(Ext.QuickTips.getQuickTip(),{showDelay:1000,hideDelay:0,interceptTitles:false})}else{Ext.apply(Ext.QuickTips.getQuickTip(),{showDelay:1000,hideDelay:0,interceptTitles:false})}});Ext.ns("Curriki");Ext.ns("Curriki.module");Ext.onReady(function(){Curriki.loadingCount=0;Curriki.loadingMask=new Ext.LoadMask(Ext.getBody(),{msg:_("loading.loading_msg")});Ext.Ajax.on("beforerequest",function(B,A){console.log("beforerequest",B,A);Curriki.showLoading(A.waitMsg)});Ext.Ajax.on("requestcomplete",function(C,A,B){console.log("requestcomplete",C,A,B);Curriki.hideLoading()});Ext.Ajax.on("requestexception",function(C,A,B){console.log("requestexception",C,A,B);Curriki.hideLoading(true)})});Curriki.id=function(A){return Ext.id("",A+":")};Curriki.showLoading=function(B,A){if(A===true){Curriki.loadingCount++}if(!Ext.isEmpty(Curriki.loadingMask)){B=B||"loading.loading_msg";Curriki.loadingMask.msg=_(B);Curriki.loadingMask.enable();Curriki.loadingMask.show()}};Curriki.hideLoading=function(A){if(A===true){Curriki.loadingCount--}if(Curriki.loadingCount==0&&!Ext.isEmpty(Curriki.loadingMask)){Curriki.loadingMask.hide();Curriki.loadingMask.disable()}else{if(Curriki.loadingCount<0){Curriki.loadingCount=0}}};Curriki.logView=function(A){if(window.pageTracker){pageTracker._trackPageview(A)}else{console.info("Would track: ",A)}};Curriki.start=function(callback){console.log("Start Callback: ",callback);var args={};if("object"===typeof callback){if(callback.args){args=callback.args}if(callback.callback){callback=callback.callback}else{if(callback.module){callback=callback.module}}}if("string"===typeof callback){var module=eval("(Curriki.module."+callback.toLowerCase()+")");if(module&&"function"===typeof module.init){module.init(args);if("function"===typeof module.start){callback=module.start}else{callback=Ext.emptyFn}}else{switch(callback){default:callback=Ext.emptyFn;break}}}if("function"===typeof callback){callback(args)}};Curriki.init=function(A){console.log("Curriki.init: ",A);if(Ext.isEmpty(Curriki.initialized)){Curriki.data.user.GetUserinfo(function(){Curriki.start(A)});Curriki.initialized=true}else{Curriki.start(A)}};Ext.ns("Curriki.data.user");Curriki.data.user={me:{username:"XWiki.XWikiGuest",fullname:"Guest"},collections:[],groups:[],collectionChildren:[],groupChildren:[],json_prefix:"/xwiki/curriki/users/",user_try:0,GetUserinfo:function(A){this.user_try++;Ext.Ajax.request({url:this.json_prefix+"me",method:"GET",disableCaching:true,headers:{Accept:"application/json"},scope:this,success:function(B,C){var D=B.responseText;var E=D.evalJSON(true);if(!E){console.warn("Cannot get user information");if(this.user_try<5){this.GetUserinfo(A)}else{console.error("Cannot get user information",B,C);alert(_("add.servertimedout.message.text"))}}else{this.user_try=0;this.me=E;this.GetCollections(A)}},failure:function(B,C){console.error("Cannot get user information",B,C);alert(_("add.servertimedout.message.text"))}})},collection_try:0,GetCollections:function(A){this.collection_try++;Ext.Ajax.request({url:this.json_prefix+this.me.username+"/collections",method:"GET",disableCaching:true,headers:{Accept:"application/json"},scope:this,success:function(B,C){var D=B.responseText;var E=D.evalJSON(true);if(!E){console.warn("Cannot read user's collection information");if(this.collection_try<5){this.GetCollections(A)}else{console.error("Cannot get user's collection information",B,C);alert(_("add.servertimedout.message.text"))}}else{this.collection_try=0;this.collections=E;this.collectionChildren=this.CreateCollectionChildren();console.log("Collections: ",this.collectionChildren);this.GetGroups(A)}},failure:function(B,C){console.error("Cannot get user's collection information",B,C);alert(_("add.servertimedout.message.text"));this.collections=[];this.GetGroups(A)}})},group_try:0,GetGroups:function(A){Ext.Ajax.request({url:this.json_prefix+this.me.username+"/groups",method:"GET",disableCaching:true,headers:{Accept:"application/json"},scope:this,success:function(B,C){var D=B.responseText;var E=D.evalJSON(true);if(!E){console.warn("Cannot read user's group information");if(this.group_try<5){this.GetGroups(A)}else{throw {message:"GetUserinfo: Json object not found"};console.error("Cannot get user's group information",B,C);alert(_("add.servertimedout.message.text"))}}else{this.group_try=0;this.groups=E;this.groupChildren=this.CreateGroupChildren();A()}},failure:function(B,C){console.error("Cannot get user's group information",B,C);alert(_("add.servertimedout.message.text"));this.groups=[];A()}})},CreateCollectionChildren:function(){var A=[];this.collections.each(function(C){var D={id:C.collectionPage,text:C.displayTitle,qtip:C.description,cls:"resource-"+C.assetType,allowDrag:false,allowDrop:true};if(Ext.isArray(C.children)&&C.children.length>0){var B=[];C.children.each(function(F){var E={id:F.assetpage,order:F.order,text:F.displayTitle,qtip:F.description,cls:"ctv-resource resource-"+F.assetType,allowDrag:false,allowDrop:false};if("undefined"===typeof F.rights||!F.rights.view){E.text=_("add.chooselocation.resource_unavailable");E.qtip=undefined;E.disabled=true;E.leaf=true;E.cls=E.cls+" rights-unviewable"}else{if(F.assetType.search(/Composite$/)===-1){E.leaf=true}else{E.leaf=false;E.allowDrop=true;E.disallowDropping=(F.rights.edit?null:true)}}B.push(E)});D.children=B}else{D.leaf=false;D.children=[]}A.push(D)});return A},CreateGroupChildren:function(){var A=[];this.groups.each(function(B){if(B.editableCollectionCount>0){var C={id:B.groupSpace,currikiNodeType:"group",text:B.displayTitle,qtip:B.description,cls:"curriki-group",allowDrag:false,allowDrop:true,disallowDropping:true};A.push(C)}});return A}};Ext.onReady(function(){Curriki.DataObservable=function(){this.addEvents({"Curriki.data:ready":true,"Curriki.data.ict:ready":true,"Curriki.data.fw_item:ready":true,"Curriki.data.el:ready":true,"Curriki.data.rights:ready":true,"Curriki.data.language:ready":true,"Curriki.data.category:ready":true,"Curriki.data.license:ready":true})};Ext.extend(Curriki.DataObservable,Ext.util.Observable);Curriki.data.EventManager=new Curriki.DataObservable();Ext.util.Observable.capture(Curriki.data.EventManager,function(A){if(A=="Curriki.data.ict:ready"){Curriki.data.ict.initialized=true}else{if(A=="Curriki.data.fw_item:ready"){Curriki.data.fw_item.initialized=true}else{if(A=="Curriki.data.el:ready"){Curriki.data.el.initialized=true}else{if(A=="Curriki.data.rights:ready"){Curriki.data.rights.initialized=true}else{if(A=="Curriki.data.language:ready"){Curriki.data.language.initialized=true}else{if(A=="Curriki.data.category:ready"){Curriki.data.category.initialized=true}else{if(A=="Curriki.data.license:ready"){Curriki.data.license.initialized=true}}}}}}}if(Curriki.data.ict.initialized&&Curriki.data.fw_item.initialized&&Curriki.data.el.initialized&&Curriki.data.rights.initialized&&Curriki.data.language.initialized&&Curriki.data.category.initialized&&Curriki.data.license.initialized){Ext.util.Observable.releaseCapture(Curriki.data.EventManager);Curriki.data.EventManager.fireEvent("Curriki.data:ready")}});Ext.ns("Curriki.data.ict");Curriki.data.EventManager.addListener("Curriki.data.ict:ready",function(){Curriki.data.ict.data=[];Curriki.data.ict.list.each(function(A){var B=_("CurrikiCode.AssetClass_instructional_component_"+A);if(A==="other"){B="zzz"}Curriki.data.ict.data.push([A,_("CurrikiCode.AssetClass_instructional_component_"+A),B])});Curriki.data.ict.store=new Ext.data.SimpleStore({fields:["id","ict","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:Curriki.data.ict.data,id:0})});Ext.Ajax.request({url:"/xwiki/curriki/metadata/CurrikiCode.AssetClass/fields/instructional_component",method:"GET",headers:{Accept:"application/json"},success:function(A,B){try{Curriki.data.ict.list=Ext.util.JSON.decode(A.responseText).allowedValues}catch(C){console.error("Invalid metadata information",A,B)}Curriki.data.EventManager.fireEvent("Curriki.data.ict:ready")},failure:function(A,B){console.error("Cannot get metadata information",A,B)}});Curriki.data.ict.getRolloverDisplay=function(B){var D=B||[];var A="";var C='<div class="ict-{0}"><img class="ict-icon" src="/xwiki/skins/curriki8/extjs/resources/images/default/s.gif" /><span class="ict-title">{1}</span></div>';if("undefined"!==typeof D&&"undefined"!==typeof D[0]){A+=String.format(C,D[0].replace(/_.*/,""),_("CurrikiCode.AssetClass_instructional_component_"+D[0]));if("undefined"!==typeof D[1]){A+=String.format(C,D[1].replace(/_.*/,""),_("CurrikiCode.AssetClass_instructional_component_"+D[1]));if("undefined"!==typeof D[2]){A+="...<br />"}}}else{A+=String.format(C,"none",_("global.title.popup.ict.missing"))}return A};Ext.ns("Curriki.data.el");Curriki.data.EventManager.addListener("Curriki.data.el:ready",function(){Curriki.data.el.data=[];Curriki.data.el.list.each(function(A){Curriki.data.el.data.push({inputValue:A,boxLabel:_("CurrikiCode.AssetClass_educational_level_"+A)})})});Ext.Ajax.request({url:"/xwiki/curriki/metadata/CurrikiCode.AssetClass/fields/educational_level",method:"GET",headers:{Accept:"application/json"},success:function(A,B){try{Curriki.data.el.list=Ext.util.JSON.decode(A.responseText).allowedValues}catch(C){console.error("Invalid metadata information",A,B)}Curriki.data.EventManager.fireEvent("Curriki.data.el:ready")},failure:function(A,B){console.error("Cannot get metadata information",A,B)}});Curriki.data.el.getRolloverDisplay=function(B){var C=B||undefined;var A="";if("undefined"!==typeof C&&"undefined"!==typeof C[0]){A+=Ext.util.Format.htmlEncode(_("CurrikiCode.AssetClass_educational_level_"+C[0]))+"<br />";if("undefined"!==typeof C[1]){A+=Ext.util.Format.htmlEncode(_("CurrikiCode.AssetClass_educational_level_"+C[1]))+"<br />";if("undefined"!==typeof C[2]){A+="...<br />"}}}else{A+=_("global.title.popup.none.selected")}return A};Ext.ns("Curriki.data.rights");Curriki.data.EventManager.addListener("Curriki.data.rights:ready",function(){Curriki.data.rights.data=[];Curriki.data.rights.initial=Curriki.data.rights.list[0];Curriki.data.rights.list.each(function(A){Curriki.data.rights.data.push({inputValue:A,boxLabel:_("CurrikiCode.AssetClass_rights_"+A),checked:Curriki.data.rights.initial==A?true:false})})});Ext.Ajax.request({url:"/xwiki/curriki/metadata/CurrikiCode.AssetClass/fields/rights",method:"GET",headers:{Accept:"application/json"},success:function(A,B){try{Curriki.data.rights.list=Ext.util.JSON.decode(A.responseText).allowedValues}catch(C){console.error("Invalid metadata information",A,B)}Curriki.data.EventManager.fireEvent("Curriki.data.rights:ready")},failure:function(A,B){console.error("Cannot get metadata information",A,B)}});Ext.ns("Curriki.data.language");Curriki.data.EventManager.addListener("Curriki.data.language:ready",function(){Curriki.data.language.data=[];Curriki.data.language.initial=Curriki.data.language.list[0];Curriki.data.language.list.each(function(A){Curriki.data.language.data.push([A,_("CurrikiCode.AssetClass_language_"+A)])});Curriki.data.language.store=new Ext.data.SimpleStore({fields:["id","language"],data:Curriki.data.language.data})});Ext.Ajax.request({url:"/xwiki/curriki/metadata/CurrikiCode.AssetClass/fields/language",method:"GET",headers:{Accept:"application/json"},success:function(A,B){try{Curriki.data.language.list=Ext.util.JSON.decode(A.responseText).allowedValues}catch(C){console.error("Invalid metadata information",A,B)}Curriki.data.EventManager.fireEvent("Curriki.data.language:ready")},failure:function(A,B){console.error("Cannot get metadata information",A,B)}});Ext.ns("Curriki.data.category");Curriki.data.EventManager.addListener("Curriki.data.category:ready",function(){Curriki.data.category.data=[];Curriki.data.category.list.each(function(A){Curriki.data.category.data.push({inputValue:A,boxLabel:_("CurrikiCode.AssetClass_category_"+A)})})});Ext.Ajax.request({url:"/xwiki/curriki/metadata/CurrikiCode.AssetClass/fields/category",method:"GET",headers:{Accept:"application/json"},success:function(A,B){try{Curriki.data.category.list=Ext.util.JSON.decode(A.responseText).allowedValues}catch(C){console.error("Invalid metadata information",A,B)}Curriki.data.EventManager.fireEvent("Curriki.data.category:ready")},failure:function(A,B){console.error("Cannot get metadata information",A,B)}});Ext.ns("Curriki.data.license");Curriki.data.EventManager.addListener("Curriki.data.license:ready",function(){Curriki.data.license.data=[];Curriki.data.license.initial=Curriki.data.license.list[0];Curriki.data.license.list.each(function(A){Curriki.data.license.data.push([A,_("CurrikiCode.AssetLicenseClass_licenseType_"+A)])});Curriki.data.license.store=new Ext.data.SimpleStore({fields:["id","license"],data:Curriki.data.license.data})});Ext.Ajax.request({url:"/xwiki/curriki/metadata/CurrikiCode.AssetLicenseClass/fields/licenseType",method:"GET",headers:{Accept:"application/json"},success:function(A,B){try{Curriki.data.license.list=Ext.util.JSON.decode(A.responseText).allowedValues}catch(C){console.error("Invalid metadata information",A,B)}Curriki.data.EventManager.fireEvent("Curriki.data.license:ready")},failure:function(A,B){console.error("Cannot get metadata information",A,B)}});Ext.ns("Curriki.data.fw_item");Curriki.data.EventManager.addListener("Curriki.data.fw_item:ready",function(){Curriki.data.fw_item.fwChildren=Curriki.data.fw_item.fwAddNode(Curriki.data.fw_item.fwMap,"FW_masterFramework.WebHome").children});Ext.Ajax.request({url:"/xwiki/curriki/metadata/CurrikiCode.AssetClass/fields/fw_items",method:"GET",headers:{Accept:"application/json"},success:function(A,B){try{Curriki.data.fw_item.fwMap=Ext.util.JSON.decode(A.responseText).allowedValueMap}catch(C){console.error("Invalid metadata information",A,B)}Curriki.data.EventManager.fireEvent("Curriki.data.fw_item:ready")},failure:function(A,B){console.error("Cannot get metadata information",A,B)}});Curriki.data.fw_item.fwCheckListener=function(C,B){var A=Ext.getCmp("fw_items-validation");if(A){A.setValue(A.getValue()+(B?1:-1))}if(B){if("undefined"!==typeof C.parentNode){if(!C.parentNode.ui.isChecked()){C.parentNode.ui.toggleCheck()}}}else{if(Ext.isArray(C.childNodes)){C.childNodes.each(function(D){if(D.ui.isChecked()){D.ui.toggleCheck()}})}}};Curriki.data.fw_item.fwAddNode=function(C,D){var B={id:D,text:_("CurrikiCode.AssetClass_fw_items_"+D),checked:false,listeners:{checkchange:Curriki.data.fw_item.fwCheckListener}};if("undefined"!==typeof C[D]){var A=[];C[D].each(function(E){A.push(Curriki.data.fw_item.fwAddNode(C,E.id))});B.children=A;B.cls="fw-item fw-item-parent"}else{B.leaf=true;B.cls="fw-item fw-item-bottom"}return B};Curriki.data.fw_item.getRolloverDisplay=function(E){var A=E||[];var F="";var D=Curriki.data.fw_item.fwMap;if(A[0]==="FW_masterFramework.WebHome"){A.shift()}if("undefined"!==typeof A&&"undefined"!==typeof A[0]){var B="";var G=A[0];var C=D["FW_masterFramework.WebHome"].find(function(H){return(D[H.id].find(function(I){return I.id==G}))});if(!Ext.type(C)){B=_("CurrikiCode.AssetClass_fw_items_"+G)}else{C=C.id;B=_("CurrikiCode.AssetClass_fw_items_"+C)+" > "+_("CurrikiCode.AssetClass_fw_items_"+G)}F+=Ext.util.Format.htmlEncode(B)+"<br />";if("undefined"!==typeof A[1]){var B="";var G=A[1];var C=D["FW_masterFramework.WebHome"].find(function(H){return(D[H.id].find(function(I){return I.id==G}))});if(!Ext.type(C)){B=_("CurrikiCode.AssetClass_fw_items_"+G)}else{C=C.id;B=_("CurrikiCode.AssetClass_fw_items_"+C)+" > "+_("CurrikiCode.AssetClass_fw_items_"+G)}F+=Ext.util.Format.htmlEncode(B)+"<br />";if("undefined"!==typeof A[2]){F+="...<br />"}}}else{F+=_("global.title.popup.none.selected")+"<br />"}return F};Ext.ns("Curriki.ui.component.asset");Curriki.ui.component.asset.getFwTree=function(){return{xtype:"treepanel",loader:new Ext.tree.TreeLoader({preloadChildren:true}),id:"fw_items-tree",useArrows:true,autoHeight:true,border:false,cls:"fw-tree",animate:true,enableDD:false,containerScroll:true,rootVisible:true,root:new Ext.tree.AsyncTreeNode({text:_("CurrikiCode.AssetClass_fw_items_FW_masterFramework.WebHome"),id:"FW_masterFramework.WebHome",cls:"fw-item-top fw-item-parent fw-item",leaf:false,expanded:true,children:Curriki.data.fw_item.fwChildren})}}});Ext.ns("Curriki.assets");Curriki.assets={json_prefix:"/xwiki/curriki/assets",CreateAsset:function(A,B,C){Ext.Ajax.request({url:this.json_prefix,method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{parent:A||"",publishSpace:B||""},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G||!G.assetPage){console.warn("Cannot create resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot create resource",D,E);alert(_("add.servertimedout.message.text"))}})},CopyAsset:function(A,B,C){Ext.Ajax.request({url:this.json_prefix,method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{copyOf:A||"",publishSpace:B||""},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G||!G.assetPage){console.warn("Cannot copy resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot copy resource",D,E);alert(_("add.servertimedout.message.text"))}})},GetAssetInfo:function(A,B){Ext.Ajax.request({url:this.json_prefix+"/"+A,method:"GET",disableCaching:true,headers:{Accept:"application/json","Content-type":"application/json"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot get resource metadata",C.responseText,D);alert(_("add.servertimedout.message.text"))}else{B(F)}},failure:function(C,D){console.error("Cannot get resource metadata",C,D);alert(_("add.servertimedout.message.text"))}})},GetMetadata:function(A,B){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/metadata",method:"GET",disableCaching:true,headers:{Accept:"application/json","Content-type":"application/json"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot get resource metadata",C.responseText,D);alert(_("add.servertimedout.message.text"))}else{if("string"===typeof F.rightsList){F.rightsList=F.rightsList.evalJSON(true)}B(F)}},failure:function(C,D){console.error("Cannot get resource metadata",C,D);alert(_("add.servertimedout.message.text"))}})},SetMetadata:function(A,B,C){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/metadata",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:B,scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot set resource metadata",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot set resource metadata",D,E);alert(_("add.servertimedout.message.text"))}})},CreateExternal:function(B,A,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/externals",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{link:A},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot create external link",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot create external link",D,E);alert(_("add.servertimedout.message.text"))}})},CreateSubasset:function(B,D,A,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/subassets",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{page:D,order:A},scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H){console.warn("Cannot add subasset",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{Curriki.data.user.GetCollections(function(){if("function"===typeof C){C(H)}})}},failure:function(E,F){console.error("Cannot add subasset",E,F);alert(_("add.servertimedout.message.text"))}})},CreateFolder:function(A,B){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/subassets",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{collectionType:"folder"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot create folder",C.responseText,D);alert(_("add.servertimedout.message.text"))}else{B(F)}},failure:function(C,D){console.error("Cannot create folder",C,D);alert(_("add.servertimedout.message.text"))}})},CreateCollection:function(A,B){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/subassets",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{collectionType:"collection"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot create collection",C.responseText,D);alert(_("add.servertimedout.message.text"))}else{B(F)}},failure:function(C,D){console.error("Cannot create collection",C,D);alert(_("add.servertimedout.message.text"))}})},CreateVIDITalk:function(A,B,C){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/viditalks",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{page:A,videoId:B},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot add video",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot add video",D,E);alert(_("add.servertimedout.message.text"))}})},Publish:function(A,B,C){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/published",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{space:B},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot publish resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot publish resource",D,E);alert(_("add.servertimedout.message.text"))}})},ReorderRootCollection:function(A,D,C,B,E){Ext.Ajax.request({url:"/xwiki/curriki/"+A+"/"+D+"/collections",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{original:C,wanted:B},scope:this,success:function(F,G){var H=F.responseText;var I=H.evalJSON(true);if(!I){console.warn("Cannot reorder",F.responseText,G)}else{E(I)}},failure:function(F,G){console.error("Cannot reorder",F,G);if(F.status==412){if(F.responseText.search(/ 107 [^ ]+ 101:/)!==-1){var H="mycurriki.collections.reorder.";if(A==="groups"){H="groups_curriculum_collections_reorder."}alert(_(H+"error"))}else{alert(_("add.servertimedout.message.text"))}}else{alert(_("add.servertimedout.message.text"))}}})},SetSubassets:function(A,D,C,B,F){var E={wanted:C};if(!Ext.isEmpty(D)){E.previousRevision=D}else{E.ignorePreviousRevision=true}if(!Ext.isEmpty(B)){E.logMessage=B}Ext.Ajax.request({url:this.json_prefix+"/"+A+"/subassets",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:E,scope:this,success:function(G,H){var I=G.responseText;var J=I.evalJSON(true);if(!J){console.warn("Cannot save subassets",G.responseText,H);alert(_("add.servertimedout.message.text"))}else{F(J)}},failure:function(G,H){console.error("Cannot save subassets",G,H);if(G.status==412){if(G.responseText.search(/ 107 [^ ]+ 101:/)!==-1){alert(_("error: Collision while saving -- only some changes saved"))}else{alert(_("add.servertimedout.message.text"))}}else{alert(_("add.servertimedout.message.text"))}}})},UnnominateAsset:function(A,B){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/unnominate",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot unnominate resource",C.responseText,D);alert(_("add.servertimedout.message.text"))}else{B(F)}},failure:function(C,D){console.error("Cannot unnominate resource",C,D);alert(_("add.servertimedout.message.text"))}})},NominateAsset:function(A,B,C){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/nominate",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{comments:B},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot nominate resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot nominate resource",D,E);alert(_("add.servertimedout.message.text"))}})},PartnerAsset:function(A,B){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/partner",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot set as Partner resource",C.responseText,D);alert(_("add.servertimedout.message.text"))}else{B(F)}},failure:function(C,D){console.error("Cannot set as Partner resource",C,D);alert(_("add.servertimedout.message.text"))}})},SetAsterixReview:function(A,C,B){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/assetManager",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{action:"setAsterixReview",asterixReviewValue:B},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot set as Partner resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot execute the action",D,E);alert(_("add.servertimedout.message.text"))}})},RemoveAsterixReview:function(A,B){Ext.Ajax.request({url:this.json_prefix+"/"+A+"/assetManager",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{action:"removeAsterixReview"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot set as Partner resource",C.responseText,D);alert(_("add.servertimedout.message.text"))}else{B(F)}},failure:function(C,D){console.error("Cannot execute the action",C,D);alert(_("add.servertimedout.message.text"))}})},Flag:function(A,C,B,D){Ext.Ajax.request({url:"/xwiki/bin/view/FileCheck/Flag?xpage=plain&page="+(A||"")+"&reason="+(C||"")+"&altreason="+(B||"")+"&_dc="+(new Date().getTime()),method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},params:{page:A||"",reason:C||"",altreason:B||""},scope:this,success:function(E,F){var G=E.responseText;var I={};try{I=G.evalJSON(true)}catch(H){I=null}if(!I){console.warn("Could not flag resource",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{if(I.success){D(I)}else{console.warn("Could not flag resource",E.responseText,F);alert("Flagging Failed")}}},failure:function(E,F){console.error("Cannot execute the action",E,F);alert(_("add.servertimedout.message.text"))}})}};Ext.ns("Curriki.ui");Curriki.ui.InfoImg="/xwiki/skins/curriki8/icons/exclamation.png";Ext.ns("Curriki.ui.dialog");Curriki.ui.dialog.Base=Ext.extend(Ext.Window,{title:_("Untitled"),border:false,modal:true,width:634,minWidth:400,minHeight:100,maxHeight:575,autoScroll:false,constrain:true,collapsible:false,closable:false,resizable:false,shadow:false,defaults:{border:false},listeners:{afterlayout:function(B,A){if(this.afterlayout_maxheight){}else{if(B.getBox().height>B.maxHeight){B.setHeight(B.maxHeight);B.center();this.afterlayout_maxheight=true}else{B.setHeight("auto")}}}},initComponent:function(){Curriki.ui.dialog.Base.superclass.initComponent.call(this)}});Curriki.ui.dialog.Actions=Ext.extend(Curriki.ui.dialog.Base,{width:634,initComponent:function(){Curriki.ui.dialog.Actions.superclass.initComponent.call(this)}});Ext.reg("dialogueactions",Curriki.ui.dialog.Actions);Curriki.ui.dialog.Messages=Ext.extend(Curriki.ui.dialog.Base,{width:500,initComponent:function(){Curriki.ui.dialog.Messages.superclass.initComponent.call(this)}});Ext.reg("dialoguemessages",Curriki.ui.dialog.Messages);Curriki.ui.show=function(D,A){var C={xtype:D};Ext.apply(C,A);var B=Ext.ComponentMgr.create(C);B.show();Ext.ComponentMgr.register(B)};Ext.ns("Curriki.ui.treeLoader");Curriki.ui.treeLoader.Base=function(A){Curriki.ui.treeLoader.Base.superclass.constructor.call(this)};Ext.extend(Curriki.ui.treeLoader.Base,Ext.tree.TreeLoader,{dataUrl:"DYNAMICALLY DETERMINED",setChildHref:false,setFullRollover:false,setAllowDrag:false,setUniqueId:false,disableUnviewable:true,hideUnviewable:false,hideInvalid:false,setTitleInRollover:false,truncateTitle:false,unviewableText:_("add.chooselocation.resource_unavailable"),unviewableQtip:_("add.chooselocation.resource_unavailable_tooltip"),createNode:function(attr){console.log("createNode: ",attr);if(this.setFullRollover){if("string"!==Ext.type(attr.qtip)&&"string"===Ext.type(attr.description)&&"array"===Ext.type(attr.fwItems)&&"array"===Ext.type(attr.levels)&&"array"===Ext.type(attr.ict)){attr.qtip=Curriki.ui.util.getTitleRollover(attr,this.setTitleInRollover)}}if("string"===typeof attr.id){var p=Curriki.ui.treeLoader.Base.superclass.createNode.call(this,attr);if(this.truncateTitle!==false){p.setText(Ext.util.Format.ellipsis(p.text,Ext.num(this.truncateTitle,125)))}console.log("createNode: parent",p);return p}attr.pageName=attr.assetpage||attr.collectionPage;if(attr.assetType=="Protected"){attr.category="unknown";attr.subcategory="protected"}attr.category=Ext.value(attr.category,"unknown");attr.subcategory=Ext.value(attr.subcategory,"unknown");var childInfo={id:this.setUniqueId?Curriki.id(attr.pageName):attr.pageName,text:attr.displayTitle||attr.title,qtip:attr.qtip||attr.description,cls:String.format("resource-{0} category-{1} subcategory-{1}_{2}",attr.assetType,attr.category,attr.subcategory),allowDrag:("boolean"==typeof attr.allowDrag)?attr.allowDrag:this.setAllowDrag,allowDrop:false};if(!Ext.isEmpty(attr.addCls)){childInfo.cls+=" "+attr.addCls}if(this.setChildHref){childInfo.href="/xwiki/bin/view/"+attr.pageName.replace(".","/")}if(attr.rights&&!attr.rights.view){childInfo.text=this.unviewableText;childInfo.qtip=this.unviewableQtip;if(this.disableUnviewable){childInfo.disabled=this.disableUnviewable}childInfo.allowDrop=false;childInfo.leaf=true}else{if(attr.assetType&&attr.assetType.search(/Composite$/)===-1){childInfo.leaf=true}else{if(attr.assetType){childInfo.leaf=false;childInfo.allowDrop=(attr.rights&&attr.rights.edit)||false}}}if(attr.rights){if(attr.rights.view){childInfo.cls=childInfo.cls+" rights-viewable"}else{childInfo.cls=childInfo.cls+" rights-unviewable";childInfo.hidden=(this.hideUnviewable||(this.hideInvalid&&attr.assetType&&attr.assetType.search(/Invalid/)!==-1))}if(attr.rights.edit){childInfo.cls=childInfo.cls+" rights-editable"}else{childInfo.cls=childInfo.cls+" rights-uneditable"}}Ext.apply(childInfo,attr);if(this.truncateTitle!==false){childInfo.text=Ext.util.Format.ellipsis(childInfo.text,Ext.num(this.truncateTitle,125))}if(this.baseAttrs){Ext.applyIf(childInfo,this.baseAttrs)}if(this.applyLoader!==false){childInfo.loader=this}if(typeof attr.uiProvider=="string"){childInfo.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}console.log("createNode: End ",childInfo);var retNode=(childInfo.leaf?new Ext.tree.TreeNode(childInfo):new Ext.tree.AsyncTreeNode(childInfo));retNode.hidden=childInfo.hidden;return retNode},requestData:function(A,B){if(A.attributes.currikiNodeType==="group"){this.dataUrl="/xwiki/curriki/groups/"+(A.attributes.pageName||A.id)+"/collections"}else{this.dataUrl="/xwiki/curriki/assets/"+(A.attributes.pageName||A.id)+"/subassets"}if(this.fireEvent("beforeload",this,A,B)!==false){this.transId=Ext.Ajax.request({method:"GET",url:this.dataUrl,disableCaching:true,headers:{Accept:"application/json"},success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:B,node:A},params:""})}else{if(typeof B=="function"){B()}}}});Ext.ns("Curriki.ui.util");Curriki.ui.util.getTitleRollover=function(A,D){var D=!Ext.isEmpty(D)?D:false;var H="";var G=A.description||"";G=Ext.util.Format.stripTags(G);G=Ext.util.Format.ellipsis(G,256);G=Ext.util.Format.htmlEncode(G);var F=A.displayTitle||A.title||"";var E=Curriki.data.fw_item.getRolloverDisplay(A.fwItems||[]);var C=Curriki.data.el.getRolloverDisplay(A.levels||[]);var B=Curriki.data.ict.getRolloverDisplay(A.ict||[]);if(!D){H=String.format("{1}<br />{0}<br /><br />{3}<br />{2}<br />{5}<br />{4}<br />{7}<br />{6}",G,_("global.title.popup.description"),E,_("global.title.popup.subject"),C,_("global.title.popup.educationlevel"),B,_("global.title.popup.ict"))}else{H=String.format("{1}<br />{0}<br /><br />{3}<br />{2}<br /><br />{5}<br />{4}<br />{7}<br />{6}<br />{9}<br />{8}",F,_("global.title.popup.title"),G,_("global.title.popup.description"),E,_("global.title.popup.subject"),C,_("global.title.popup.educationlevel"),B,_("global.title.popup.ict"))}return H};(function(){Ext.ns("Curriki.ui.Rating");var B=[];for(var A=0;A<5;A++){B.push(_("CurrikiCode.AssetClass_member_rating_"+(A+1)))}Curriki.ui.Rating=Ext.extend(Ext.form.NumberField,{fieldClass:"x-form-field x-form-rating-field",allowDecimals:false,allowNegative:false,minValue:0,maxValue:5,unit:17,wrapClass:"ux-form-rater-wrap",starsClass:"ux-form-rater-stars",hoverClass:"ux-form-rater-hover",voteClass:"ux-form-rater-vote",votedClass:"ux-form-rater-voted",textRightClass:"ux-form-rater-text-right",hoverText:B,displayValue:undefined,ratedValue:undefined,hoverValue:undefined,rated:false,initComponent:function(){Curriki.ui.Rating.superclass.initComponent.call(this);this.addEvents("beforerating","rate")},onRender:function(D,C){Curriki.ui.Rating.superclass.onRender.apply(this,arguments);this.wrap=this.el.wrap({cls:this.wrapClass});if(Ext.isIE){this.wrap.setHeight(this.unit)}this.el.addClass("x-hidden");this.createStars();this.createTextContainers();this.displayValue=(this.displayValue>this.maxValue)?this.maxValue:this.displayValue;if(this.displayValue>0||this.getValue()>0){this.displayRating()}},initEvents:function(){Curriki.ui.Rating.superclass.initEvents.call(this);var D=this.getStarsContainer();var C=this.getStars();C.on("mouseover",this.displayHover,this);C.on("mouseout",this.removeHover,this);C.on("click",this.rate,this);C.on("mouseup",this.rate,this)},displayHover:function(G){if(this.disabled){return }var F=Ext.get(G.getTarget());F.addClass(this.hoverClass);var E=this.getRating();E.hide();var C=this.getStars();var D=0;while(C.item(D)!=null){if(C.item(D)==F){this.hoverValue=this.maxValue-D;if(this.hoverText instanceof Array){if(!Ext.isEmpty(this.hoverText[this.hoverValue-1])){this.setRightText(this.hoverText[this.hoverValue-1])}}return }D++}},removeHover:function(E){if(this.disabled){return }var D=this.getRating();D.show();var C=E.getTarget();Ext.fly(C).removeClass(this.hoverClass);this.setRightText("")},rate:function(D){if(this.disabled){return }var C=this.hoverValue;this.setValue(C);if(this.fireEvent("beforerating",this)===false){return }this.removeHover(D);this.onBlur();this.rated=true;this.displayRating(C);this.fireEvent("rate",this,C)},createStars:function(){if(this.getStars().getCount()>0){return }var D=this.wrap.createChild({tag:"ul",cls:this.starsClass}).setSize(this.unit*this.maxValue,this.unit);var G=new Ext.Template('<li class="rating"></li>');var F=new Ext.Template('<li class="star"></li>');G.append(D,[],true).setHeight(this.unit);for(var C=this.maxValue;C>0;C--){var E=F.append(D,[],true);E.setSize(this.unit*C,this.unit)}this.alignStars()},createTextContainers:function(){var C=this.getStarsContainer();if(!this.textRightContainer){this.textRightContainer=Ext.DomHelper.insertAfter(C,{tag:"span",cls:this.textRightClass},true);this.textRightContainer.addClass("x-hidden")}},setRightText:function(C){this.textRightContainer.dom.innerHTML=C;if(C==null||C==""){this.textRightContainer.addClass("x-hidden")}else{this.textRightContainer.removeClass("x-hidden")}},getRightText:function(){return this.textRightContainer.dom.innerHTML},displayRating:function(D,F){var E=this.getRating();if(Ext.isEmpty(D)){D=(this.displayValue==null)?this.getValue():this.displayValue;D=Ext.isEmpty(D)?0:D}if(this.ratedValue>0){D=this.ratedValue;this.rated=true}var C=function(G,H){if(F==true){E.replaceClass(H,G)}else{E.replaceClass(G,H)}};C(this.votedClass,this.voteClass);E.setWidth(D*this.unit);return },getStars:function(){return this.wrap.select("li.star",true)},getStarsContainer:function(){return this.wrap.select("."+this.starsClass,true).item(0)},getRating:function(){return this.wrap.select("li.rating",true)},alignStars:function(){var D=this.getStarsContainer();var E=this.getRating();var C=this.getStars();var G=(D.findParent(".x-form-item",5))?true:false;if(false&&!G){var F=Ext.fly(document.body).getAlignToXY(D)[0];E.setLeft(F);C.setLeft(F)}else{E.alignTo(D,"tl");C.alignTo(D,"tl")}},onDisable:function(){Curriki.ui.Rating.superclass.onDisable.call(this);this.wrap.addClass("x-item-disabled")},onEnable:function(){Curriki.ui.Rating.superclass.onEnable.call(this);this.wrap.removeClass("x-item-disabled")},onHide:function(){this.wrap.addClass("x-hidden")},onShow:function(){this.wrap.removeClass("x-hidden")}});Ext.reg("rating",Curriki.ui.Rating)})();